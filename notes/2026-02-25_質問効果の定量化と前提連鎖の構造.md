# 質問効果の定量化と前提連鎖の構造

## 背景

プレイヤーが「自分で考えて答えに辿り着く」感覚の欠如という課題に対し、
「ある質問によってどれほど答えに近づいたか」を定量化するための分析。

## 答えに近づくとは何か

「答え」= 最終パラダイム（P_final）の説明。
答えに近づくことに関連する量として以下を挙げた:

1. **正解パラダイムとのalignment変化** — `alignment(h, P_final)` の回答前後の差分
2. **コア記述素のH変化** — P_finalのコア記述素のH値が真の値に向かって動いたか
3. **現パラダイムへのtension蓄積** — 誤ったパラダイムからのシフトを促す力
4. **正解パラダイムのexplained_oの増加** — 新たな観測が正解パラダイムで説明できるか

## IC（is_clear質問集合）からの逆算

is_clear = True の質問群を IC と定義する。
ICの要素数は答えへの到達可能性を示す基本的な変数。

ICから逆算すると、各IC要素がオープンするための**前提の連鎖**が見える。

質問がオープンする条件:
1. **Conceivable制約** — 参照記述素が現パラダイムのconceivable内
2. **Prerequisites制約** — prerequisitesの記述素がすべてO（観測済み）に含まれる
3. **H近接条件** — 効果記述素のいずれかで |H(d) - v| < EPSILON

各IC要素に連なる質問の集合 = prerequisitesを遡った依存の連鎖。
ユーザーの体験としては、可能性を段階的に絞り込んでいく推論の道筋に対応する。

## 前提連鎖と関連量の関係

前提の連鎖を進むには2種類の障壁がある:

- **H近接条件の障壁** → alignment（上記1）が対応。連鎖上の質問に答えるたびにHが動き、P_finalのp_predに近づく方向であれば、次の質問のH近接条件を満たしやすくなる。alignmentは連鎖上の「進みやすさ」を反映する。

- **Conceivable制約の障壁** → tension（上記3）が対応。連鎖の途中に現パラダイムのconceivable外の質問がある場合、パラダイムシフトが必要。シフトはtensionによって駆動される。tensionは連鎖上の「パラダイムの壁」を越えるための力。

つまり前提連鎖を軸として、alignmentとtensionはそれぞれ異なる種類の障壁への対応として位置づけられる。

## 絞り込みの鋭さ

同じ1問への回答でも、絞り込みの鋭さは異なる。

具体例（包含関係のある絞り込み）:
- 「過去に何か悪いことがありましたか？」→ Yes（広い）
- 「過去に誰かが死にましたか？」→ Yes（⊂ 悪いこと）
- 「死んだのは男の仲間ですか？」→ Yes（⊂ 誰かが死んだ）

この包含関係は、アプリ側ではprerequisitesとして構造化されている。前提連鎖は論理的な包含関係の階層を段階的に降りることを強制する制御機構でもある。

鋭さに関わる要素:
- **前提連鎖のパス深さ** — 深い階層の質問ほど、より狭い部分集合に絞り込む
- **それだけではない** — 同じ深さでも鋭さが異なりうる。何が関わるかは可能性空間の分析が必要

## 可能性空間と記述素空間の関係

記述素空間 {0, 1}^n を可能性空間そのものとして捉えられるか検討した。

**問題: 均質性の欠如**
- {0, 1}^n では各次元が均等で、どの記述素を1つ確定しても空間は一律に半減する
- しかし実際には記述素によって排除される可能性の意味的重みが大きく異なる
  - 「人肉を食べた」の確定 vs 「一人で来た」の確定
- 記述素空間をそのまま可能性空間と見做すには、この非均質性を反映する構造が必要

**方針: 可能性空間は別に定義する**
- 記述素空間に構造を載せるより、可能性空間を独立に定義して記述素空間との対応関係を考える方が理論的に正しい
- 活用が難しければ当面無視するが、位置づけは確立しておく

## 可能性空間の基本構造

問題文・真理・質問の三者の関係から可能性空間を位置づける。

**構成要素**:
- **問題文** — 可能性空間を生成する。問題文を聞いた人が想像しうる世界（「なぜ？」に対するありうる答え）の有限集合が可能性空間となる
- **真理** — 可能性空間の中の一点。ゲームの正解となる事実の全体
- **質問** — 可能性空間を分割する。Yes/Noの回答により一方の領域を排除し、空間を縮小する

**有限性が本質**:
- 記述素空間 {0, 1}^n は均質で、どの記述素を確定しても空間が一律に半減するため、質問の良し悪しが表現できない
- 可能性空間は有限個の「ありうる世界」からなり、{0, 1}^n よりはるかに小さい
- 有限集合の中で質問が切ることで、分割は自然と非均等になり、質問の良し悪しが生まれる
- 非均質性は測度の導入ではなく、空間自体の有限性から導かれる

## 可能性空間と記述素空間の関係

可能性空間Wの各要素（ありうる世界）は記述素に対して特定の真偽パターンを持つ。これにより写像 φ: W → {0, 1}^n が定まる。

**写像の性質**:
- **全射ではない** — {0, 1}^n の大部分は意味ある世界に対応しない。記述素間の制約による:
  - 論理的矛盾:「一人で来た」=1 かつ「妻と来た」=1 は成立しない
  - 含意関係:「仲間が死んだ」=1 なら「誰かが死んだ」=1 でなければならない
  - 整合性: 問題文の説明として意味をなす組み合わせでなければならない
- **単射は現実的でない** — 完全な単射はWの大きさに対して記述素が不足するため、ほぼ不可能。重要なのはφの「潰れ方」の構造:
  - ゲームが解けるために必要なのは、真理が他のすべての世界と区別できること（φ(真理) ≠ φ(w) for all w ≠ 真理）であり、完全な単射は十分条件であって必要条件ではない
  - 真理の近くではφの解像度が高くなければならない（ファイバーが小さい）。遠い世界は粗く潰れていても問題ない
  - この解像度の勾配は前提連鎖の深さと対応する——浅い部分は粗い解像度（多くの世界をまとめて排除）、深い部分は高い解像度（真理の近傍を細かく区別）

**質問の位置づけ**:
質問は記述素の値を明らかにすることで、この写像φを通じて可能性空間を間接的に分割する。

**前提連鎖とWの縮小**:
前提連鎖のパスは、可能性空間の中で真理に向かって縮小していく経路と見なせる:

W = W₀ ⊇ W₁ ⊇ W₂ ⊇ ... ⊇ {真理}

パス上の各ステップが質問に対応し、Wを切って縮小する。ただし:
- 縮小が常に厳密とは限らない（ある質問の答えが残りの全世界と整合する場合 W_{k+1} = W_k）
- パスは一本ではなく分岐する（前提連鎖はDAG）。プレイヤーの選択によって異なる経路を取るが、最終的に同じ方向に収束する
- 同じ深さでも経路によって縮小の度合いが異なりうる

## 質問の良し悪しと記述素の重要性

**質問の良さ**:
残りの可能性空間をどれだけ効果的に縮小し真理に近づけるか。ゲームの段階によって変わる:
- 序盤: 大きく切り落とす粗い質問が良い
- 終盤: 残った似た世界を細かく区別する質問が良い

**記述素の重要性**:
記述素自体の固有の性質ではなく、Wの構造——ありうる世界がその記述素に対してどう分布しているかと、真理がどちら側にあるかの組み合わせ——によって決まる。

具体例（ウミガメのスープ）:
- 「男はレストランに来た」— ほぼ全ての世界で真。値を明かしてもWはほとんど縮小しない
- 「過去に誰かが死んだ」— 一部の世界で真、一部で偽。Wをそれなりに分割する
- 「男は人肉を食べた」— ごく少数の世界でのみ真。真理はその少数側にある。値が明かされるとWが劇的に縮小する

真理が少数派の側にある記述素ほど、明かされたときの絞り込みが鋭い。

## 記述素への量の対応づけ

記述素に重要性のような量を対応させる方向性を検討した。

**利点**:
- 記述素はモデルの基本単位なので、質問の評価や設計指針に直結する
- 前提連鎖上の各ステップの「重み」としてゲーム体験の分析に使える

**問題点**:
- **文脈依存性**: 同じ記述素でも、既に何が観測されたかで重要性が変わる。例:「誰かが死んだ」が確定済みなら「何か悪いことがあったか」の情報量はゼロになる。前提連鎖がこの順序をある程度制御しているが、静的な一つの量では捉えきれない
- **Wの知識が必要**: 量の算出には可能性空間Wの構造が必要だが、Wの列挙自体が未解決
- **相互作用の喪失**: 記述素の重要性は他のどの記述素が既に明かされたかに依存し、単独の量では条件付き依存関係を表現できない

**方向性: 状態依存の量 importance(d, O)**:
文脈依存性を正面から受け入れ、静的な importance(d) ではなく現在の観測集合Oに依存する importance(d, O) を定義する。Wを明示的に列挙せずに近似する手段として:
- パラダイムをWの部分集合と見なし（各パラダイムはその枠組みで説明できる複数の世界を包含する領域）、dの値によって残りの候補パラダイムがどう分かれるかで評価する
- 前提連鎖上での位置から、dが下流でどれだけの質問を開放するか（連鎖効果）で評価する
- これらを組み合わせて importance(d, O) を近似する

## 既存概念の可能性空間Wにおける位置づけ

**パラダイム**: Wの部分集合。各パラダイムはその枠組みで説明できる複数の世界を包含する領域。

**O（観測集合）**: Wの客観的な縮小。観測が蓄積するたびにW内の整合する世界の集合が単調に縮小する。

**H（信念ベクトル）**: W内のプレイヤーの認知的な位置。[0, 1]^n の点として、強い信念を持つ次元は世界を制約し、不確実な次元は開いたままにする。これによりHは「プレイヤーが現在ありうると考えている世界の集合」をW内に定める。Oによる客観的縮小が単調であるのに対し、Hの認知的集合は非単調——誤ったパラダイム下では真理から離れた領域に留まりうる。

**パラダイムシフト**: Hの認知的集合がW内のあるパラダイム領域から別の領域へ跳躍すること。現在の理論枠組みの機構との対応:
- tension > threshold — Oが現パラダイム領域からはみ出していることの検出
- explained_oによる候補選択 — Oをよりよく包含する領域を探す
- alignmentによる最終選択 — Hの認知的位置に近い領域を優先する
- 再同化 — Hを新しいパラダイム領域内に引き込む

現在の機構はWを明示せずに、W内での跳躍を近似的に実現している。ただしパラダイムという粗い粒度での操作であり、W内の細かい構造は扱えていない。

## クリア条件の形式化

**基本記号**:
- D = {d_1, ..., d_n}: 記述素全体
- v: D -> {0, 1}: 真理（各記述素の真の値）
- O ⊆ D: 観測済み集合（値が確定した記述素）

**クリア集合と族**:
- S ⊆ D がクリア集合 ⟺ O ⊇ S ならゲームクリア
- F = {S_1, ..., S_m}: クリア集合の族（clearing family）

**族の構造**:
- S_i ∩ S_j ≠ ∅（一般に重複あり）
- ∩F: 全クリア集合の共通部分（不可欠な核）
- ∪F: 全クリア集合の和（関連記述素全体）

**最小性**:
- S_i が最小 ⟺ S_i の真部分集合にクリア集合がない

## 前提構造の帰属先

### 前提は認知的構造である

記述素間の前提関係（pre(d)）を D 上に定義することを検討したが、前提は客観的な論理関係ではなく認知的なものである。例:
- d = "男は泣いた" の前提として {"男は悲しかった"} または {"男は真実を知った"} がありうる
- これは d の論理的条件ではなく、プレイヤーが d について問えるようになる認知的条件

したがって D は単なる集合として保ち、論理的構造（含意・矛盾）は W と φ に任せる。前提構造は認知レベルの別の層に置く。

### D 上の構造について

D に含意・矛盾の構造を明示的に入れることは可能だが、それは W を D 側から記述し直すことに等しく、複雑さが増すだけで新しい情報を加えない。φ: W -> {0,1}^n の非全射性がこれらの制約を既に暗黙に表現している。

### パラダイムの位置づけ: 客観と認知の中間

パラダイムは W の部分集合（客観的側面）であると同時に、conceivable や relations を通じてプレイヤーの認知を制約する（認知的側面）。この中間的位置から、認知的構造である前提をパラダイムに組み込むのが自然。

### 質問をパラダイムに帰属させる

前提構造の載せ方として二つの方向を比較した:
- A: 記述素に前提構造を入れる（pre_P(d)）
- B: 質問をパラダイムに帰属させ、質問間の関係として構造化する

B を採用する。理由:
- 前提は認知的構造であり、認知的単位（質問）に載せるのが整合的
- 質問が複数の記述素を束として明かす構造が自然に保たれる
- 現モデルの構造に近く、新しい層の追加が不要

### 各パラダイムが独立した質問集合を持つ

各パラダイム P は独立した質問集合 Q(P) を持つ。パラダイム間で質問を共有する必要はない。

**共有質問が不要な理由**:
- パラダイムシフトは P1 自身の質問への回答が P1 の予測と矛盾することで駆動される（tension の蓄積）
- アノマリーは P1 内部で発生するため、P2 の質問が事前にアクセス可能である必要はない
- シフト後に Q(P2) が利用可能になり、既に蓄積した O が Q(P2) 内の質問の前提を満たしていれば進行できる

**利点**:
- 質問設計がパラダイムごとに独立し、シンプルになる
- パラダイム間の質問の整合性を気にする必要がない
- 各パラダイムの質問構造を個別に最適化できる

## 質問の重要度

質問の重要度は二つの軸で分解される:

### パラダイム間: パラダイムの位置

パラダイムが真理（P_final）にどれだけ近いかで、そのパラダイムに属する質問全体の位置づけが決まる。

### パラダイム内: 目的による序列

P_final とそれ以外で質問の目的が異なる:

**P_final 以外のパラダイム**: 目的はパラダイムシフトを起こすこと。質問はアノマリー寄与で序列化される:
- **アノマリー 0**: P の予測と一致する回答を生む。直接には tension に寄与しないが、前提としてアノマリー質問を開放する役割
- **アノマリー 1+**: P の予測と矛盾する観測を生む。tension を直接蓄積し、シフトを駆動する。アノマリー数が多いほどシフトへの寄与が大きい

**P_final**: 目的はクリア集合への到達。質問はクリア集合 F の要素にどれだけ直接的に寄与するかで序列化される。

### R(P) による質問のオープン順序

パラダイム内の質問の到達可能性は R(P)（関係構造）が制御する:

1. d_src を観測し、P の予測と一致する場合
2. 同化により R(P) の関係 (src, tgt, w) を通じて H(d_tgt) が P の予測値に向かって動く
3. H(d_tgt) が閾値に達すると、d_tgt を参照する質問がオープンする

R(P) の接続構造がそのままパラダイム内の質問の到達可能性の構造になる。アノマリー質問への到達もこの経路上にあり、R(P) が「どの質問を経由してアノマリーに辿り着くか」を規定する。

H の役割:
- **パラダイム内**: R(P) を通じた同化伝播により質問のオープン順序を制御する
- **パラダイム間**: alignment(H, P') としてシフト先パラダイムの選択に関わる

## パラダイム内の多層構造

### 構造のイメージ

パラダイム内の質問構造を、複数の丸で囲まれた領域を持つ面が多層に重なった構造として捉える。

- **層**: 前提の深さレベルに対応する面
  - 層 0: 前提なしの質問群（初期オープン）
  - 層 1: 層 0 の回答で開く質問群
  - 層 k: 層 k-1 の回答で開く質問群
  - 最深層付近: アノマリー質問
- **丸の領域**: 次の層への通路（ゲート）。H がその領域に到達すると上の層に上がれる
- **層内の丸同士**: 互いに独立（前提関係がない並列な分岐）

### H の位置づけ: 層内を移動・広がる認知

H は「抵抗」ではなく「層内を探索する主体」として位置づける。

認知のプロセス:
1. 質問に回答して記述素を観測する（事実の観測）
2. R(P) に基づいて関連する記述素の H が動く（連想）
3. H が閾値に達した記述素を参照する質問がオープンする（新たな質問を思いつく）

R(P) は H が層内でどのように広がれるかの地形を定める。関係 (src, tgt, w) が「何を観測したら何を連想するか」を定義し、重み w が連想の強さを表す。

### 二軸の対応

- **横の連想** = H が層内で広がること。観測→同化→関連記述素への認知の波及
- **縦の絞り込み** = 丸の領域を通って層を上がること。前提の充足による深い質問の開放

### アノマリーの位置

アノマリー質問は上層に位置する。縦の絞り込みを経て到達する。アノマリーからの逆算で各パラダイム内の質問構造を設計できる:
- 目的地（アノマリー質問）を定める
- そこに至る前提の連鎖を下の層に向かって展開する
- 各層内で R(P) による連想の広がりを設計する

## conceivable(P) と Q(P) の関係

conceivable(P) が原始概念として「P の思考範囲」を記述素レベルで定義し、Q(P) はそこから導出される:

Q(P) = {q | q の effect 記述素 ⊆ conceivable(P)}

conceivable(P) を原始概念とする利点:
- 質問の追加・変更があっても conceivable(P) を変える必要がない
- 記述素レベルの定義なので、質問より安定した概念

先の整理（独立した質問集合、多層構造、R(P) による H の広がり）は、Q(P) を上記で導出されるものと考えても全て成立する。

## Q(P) の定量評価

評価の方針: conceivable(P) から Q(P) を導出し、層構造を構築し、パラダイムごとに独立に評価する。P_final 以外はアノマリーからの逆算、P_final はクリア集合からの逆算。

### 層の形状

- **総層数（深さ）**: アノマリーまで何段階か。浅すぎると発見感がなく、深すぎると冗長
- **各層の幅**: 並列な質問数。選択肢の豊かさ
- **漏斗性**: 層が進むにつれて幅がどう変化するか

### アノマリーの配置

- **初回アノマリー到達深さ**: 最初のアノマリーが何層目に現れるか
- **アノマリーの層分布**: 一箇所に集中か、複数層に分散か。分散していれば tension が段階的に蓄積する

### 経路の構造

- **アノマリーへの経路数**: 冗長性。複数経路があればプレイヤーの選択に幅がある
- **ボトルネック**: 全経路が通る必須質問の存在。あるとそこで詰まるリスク

### R(P) の波及

- **ゲート開放率**: 層 k の回答で層 k+1 のゲートがどれだけ開くか
- **同化カバー率**: R(P) による H の広がりが層内のどれだけの記述素に及ぶか

### tension の蓄積曲線

- 層を進むにつれて tension がどう増加するか。理想的には段階的な蓄積

## Q(P) 構造分析の適用結果（ウミガメのスープ）

### 主要な観察

paradigm_qp.py をウミガメのスープのデータに適用した結果:

| パラダイム | |Q(P)| | 層数 | アノマリー数 | 層0のアノマリー | 層0率 |
|-----------|--------|------|-------------|--------------|-------|
| P1（日常的な食事体験）| 56 | 7 | 27 | 17 | 63% |
| P2（過去の味覚体験）| 28 | 5 | 12 | 6 | 50% |
| P3（過去の嘘の発覚）| 35 | 8 | 5 | 4 | 80% |
| P4（極限状況での隠蔽）| 41 | 7 | 3 | 3 | 100% |
| P5（人肉の発覚と絶望）| 18 | 1 | 0 | - | - |

### 問題の特定

**アノマリーの層0集中**: 全パラダイムでアノマリーが層0に集中している。先の理論（「アノマリーは上層に位置し、縦の絞り込みを経て到達する」）と真逆の構造。

これは「自分で考えて答えに辿り着く」感覚の欠如という元の課題と直接的に対応する。アノマリーが最初から見えているため、段階的な発見のプロセスが存在しない。

**P5の単層構造**: 最終パラダイムの質問が全て層0に位置し、前提連鎖がない。クリア集合に向けた段階的な到達構造が存在しない。

### 原因の分析

直接的な原因は、アノマリーを生む記述素（Ft-03, Ft-22, Ft-09 等）が前提なしの質問から直接到達できること。つまり質問の prerequisites 設計が不足している。

しかしこれは質問生成アルゴリズムだけの問題ではない。

### 理論アルゴリズムへの波及

影響は質問生成の上流に遡る:

**1. 質問生成アルゴリズム**: 直接的に大幅な見直しが必要。アノマリーを深層に配置し、到達に前提の連鎖を要する構造を生成するアルゴリズムでなければならない。

**2. 記述素空間 D の設計**: 現在の記述素が粗すぎる可能性。アノマリーを深層に置くには、そこに至るまでの中間的な記述素（観測のステップストーン）が必要。D の粒度と構成がこの多層構造を支えるものでなければならない。

**3. パラダイムの conceivable と R(P)**: conceivable(P) が Q(P) を生成し、R(P) が層内の H 伝播を定めるため、多層構造の実現にはこれらの設計も連動する必要がある。特に R(P) は「浅い層の観測→同化→深い層のゲート開放」という縦方向の進行を支える役割を持ち、その接続構造が層を生み出す。

**4. 可能性空間 W との整合**: 記述素の追加・再構成は φ: W → {0,1}^n の構造を変え、W の分割の仕方が変わる。多層構造が W における「粗い分割→細かい分割」の段階と整合している必要がある。

### 再構築の方向性

依存方向は: 理論アルゴリズム → サンプル → データ。

サンプル（ウミガメのスープの分析）を起点にデータを付け焼き刃的に修正するのではなく、理論アルゴリズムの段階で「多層のアノマリー到達構造」を生成する原理を確立し、それをサンプルに適用し直す必要がある。

## 理論アルゴリズムの改善

### 質問設計の方向転換: 前方積み上げから逆算へ

現在の質問生成アルゴリズム（Q1/Q2）は前方向に積み上げる設計である:

1. 記述素から質問候補を網羅生成
2. パラダイムごとに拡充
3. 偶然の開きを追加
4. 役割付与・大区分配置
5. prerequisites を後付け（「論理的に成立するために必要な記述素」）

この結果、偶然の開き（アノマリーを含む質問）の prerequisites が空になり、層0に配置される。偶然の開きは「開放記述素で質問が開き、異常記述素でアノマリーを生む」構造だが、開放記述素が前提なしで到達可能なら質問は層0になる。

改善の原理: **アノマリーからの逆算による質問構造設計**

1. アノマリー質問を決定する
2. そのアノマリー質問に到達するための認知ステップを逆算で設計する
3. 各ステップが質問の prerequisites として表現される
4. ステップ間の遷移を R(P) の同化が支える

これは偶然の開きの定義自体は変えず、その「配置」を深い層に制御することに相当する。

### prerequisites の再定義

現在: 「質問が論理的に成立するために確定済みであることを要求する記述素」（受動的）
改善: 「アノマリーへの認知的到達経路を構成する条件」（能動的）

前提は論理的条件ではなく認知的条件であることは既に確認済み。これをアルゴリズムレベルで反映する。prerequisites は後付けの制約ではなく、質問構造設計の中心的な構成要素となる。

### R(P) の役割拡張: ゲート辺

R(P) の形式定義（Conceivable × Conceivable × W）は変えないが、構成方法に新しい概念を導入する。

- **横辺**: 同一層内の因果・含意関係（現在の Rule 1-3）。同化による H の層内での広がり
- **ゲート辺**: 浅い層の記述素から深い層の記述素への関係。同化により深い層の記述素の H が閾値に近づき、次の層の質問がオープンする

R(P) は「横の連想」と「縦のゲート開放」の両方を担う。これは R(P) の関係構造構成（内部構造構成アルゴリズム Step 5）の改訂として実現する。

### 共有質問・架橋質問の廃止

Q1/Q2 は「共有質問」（共有想起記述素のみに効果）と「架橋質問」（複数パラダイムの固有想起記述素にまたがる効果）という分類を前提にしている。

- 共有質問: 緊張を生まないが、シフト先の alignment を高める（方向づけ）
- 架橋質問: アノマリーを蓄積し tension を高める（推進力）

この分類は「質問がどのパラダイムの記述素に属するか」で事前に設計しようとするものだが、適切でない。

**本質はシフトの方向制御にある。** 重要なのは:

1. アノマリー等のインパクトある質問が H をどの方向に動かすか
2. その H の動きが、シフト時に正しい方向（想定する次のパラダイム）へ導くか

これは質問の静的な属性（共有/架橋）ではなく、**シフト時点での O と H の状態**として現れる。したがって質問の事前分類ではなく、シフトごとのシミュレーションとして評価すべきである。

**廃止するもの**:
- 共有質問・架橋質問という質問分類
- Q1 の共有質問・架橋質問に基づく設計ステップ
- 「パラダイム群の構造」「パラダイムシフトの機構」における共有質問・架橋質問の記述

**代わりに導入するもの**:
- シフトごとの質問群シミュレーション（検証工程）
  - P_i フェーズの質問を順に回答した際の H の変化を追跡
  - シフト発動時の alignment(H, P') を各候補について計算
  - 想定する P_{i+1} が最大 alignment を持つことを検証
- 質問設計の側では「H の方向」を意識するが、保証はシミュレーションが担う

### 質問集合の独立性

各パラダイムは独立した質問集合を持つ（先の整理で確認済み）。Q(P) = {q | effect(q) の記述素 ⊆ conceivable(P)} で導出される。パラダイム間で質問が重複することはあるが（同じ質問が複数のパラダイムの conceivable に含まれる）、これは導出の結果であり、設計上の「共有」ではない。

## 統合アルゴリズムの構成

個別アルゴリズム（E1/E2, A_深度階層型, A_内部構造構成, Q1/Q2, S1）の組み合わせと適用順を、テンプレートの暗黙の固定から理論レベルのアルゴリズムとして明文化する。

### 現状の構造

テンプレートの暗黙の順序: E → A発見 → A内部 → Q → 形式化 → S1検証

個別アルゴリズム間の反復は S1 の備考で「将来的な統合アルゴリズム」として言及されるのみで未設計。

### 統合アルゴリズムの構成: 3フェーズ + 検証ループ

**Phase 1: 空間構築（前方向の積み上げ）**

E1/E2 → A_深度階層型 → A_内部構造構成

Ps/Pt から記述素空間を展開し、パラダイム群を発見し、内部構造（P_pred, Conceivable, R(P)）を構成する。ここは既存の個別アルゴリズムと同じ。ただし後段のフィードバックで記述素の追加や R(P) の修正が入りうる。

**Phase 2: 質問構造設計（逆方向 ← 新規）**

Phase 1 の出力を受けて、アノマリーからの逆算で各パラダイムの質問構造を設計する。

- 2a. アノマリー目標設定: 各パラダイムの conceivable(P) 内で P_pred ≠ T のペアを列挙し、アノマリー質問の目標を決定
- 2b. 認知的到達経路の逆算: アノマリー質問に到達するための認知ステップを設計。「プレイヤーがこれを知って初めて次を思いつく」条件の連鎖
- 2c. 層構造への配置: 逆算された経路をもとに質問を層に配置。偶然の開きは深い層に位置。各層の横の広がりを R(P) と関連づけて設計
- 2d. 素材不足の検出: 中間ステップに対応する記述素やゲート辺の不足を検出

**Phase 3: 質問生成（統合）**

Phase 2 の構造設計をもとに、具体的な質問を生成する。

- 3a. 質問候補生成（Q1 Step 1-3 に相当。Phase 2 の層配置を尊重）
- 3b. prerequisites の設定（Phase 2 の逆算結果から導出）
- 3c. 役割付与・大区分配置
- 3d. フェーズ到達・同化接続性の検証（Q2 Step 7-9 に相当）

**Phase 4: 検証と反復**

- 4a. 静的検証（opening_reach: anomaly 到達性）
- 4b. 動的検証（anomaly_discovery: 発掘連鎖到達性）
- 4c. 多層構造検証（paradigm_qp: アノマリーの層分布、ゲート開放率）← 新規
- 4d. シフト方向検証（シフトごとの質問群シミュレーション）← 新規。共有質問・架橋質問の代替
- 4e. 不足時の差し戻し:
  - 素材不足（記述素、R(P)）→ Phase 1 へ
  - 構造不足（経路、層配置）→ Phase 2 へ
  - 質問不足（質問数、偶然の開き）→ Phase 3 へ

### フェーズ間の依存と反復

```
Phase 1 → Phase 2 → Phase 3 → Phase 4
              ↑          ↑          |
              |          +----------+ (質問不足)
              +---------------------+ (素材不足・構造不足)
```

検証が通れば形式化（JSON 変換）に進む。

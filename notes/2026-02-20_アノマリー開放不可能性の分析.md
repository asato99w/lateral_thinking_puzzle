# アノマリー開放不可能性の分析

## 背景

game_simulation.py（open(H) に基づく完全シミュレーション）を作成・実行したところ、ゲームが14問で行き詰まり、P1 から一切遷移できないことが判明した。

## 発見された問題

### シミュレーション結果

- 初期オープン: 14問（すべて P1 が正しく予測する質問）
- 14問回答後: オープン質問 0、パラダイムシフト 0
- P1 の tension は終始 0（アノマリーなし）
- 48問が未回答のまま行き詰まり

### 原理的な構造

以下の3点が組み合わさり、アノマリーが原理的に発生し得ない。

1. **open(H) は H[d] ≈ 正解値 で開く**
   - H はプレイヤーの予想の推定。予想が正解に近いとき、その質問を思いつく
   - この設計自体は正しい

2. **同化は現パラダイムの予測方向に H を押す**
   - D⁺ 記述素: H → 1（パラダイムが「真」と予測）
   - D⁻ 記述素: H → 0（パラダイムが「偽」と予測）
   - これも正しい動作

3. **アノマリーを生む質問の正解は、P の予測と逆方向**
   - d ∈ D⁻(P1) のとき、アノマリーになるには正解が v=1
   - open に必要: H[d] ≈ 1
   - しかし同化で H[d] → 0 に押されている
   - gap が拡大し続け、質問は開かない

結果: アノマリーを生む質問が開かない → tension = 0 → パラダイムシフトなし → 行き詰まり

## 検討: open ロジックの変更ではなく、H の動きと構造を見るべき

open(H) のロジックを変更してアノマリーを生む質問を無理に開かせることは、「プレイヤーにとって意外性のあるものをシステム側で用意する」ことになり、設計思想に反する。

検討すべき方向:

1. **H の動き方**: 同化以外で H を動かす仕組みがあるか
2. **空間・質問の構造による偶然の開き**: 質問構造から自然にアノマリーが持ち込まれる経路があるか

## 偶然の開き

### 原理

質問の effect が複数の記述素を含む場合:

```
質問 q: effect = [(d1, v1), (d2, v2)]

open 条件: いずれか一つ (d_i, v_i) について H[d_i] ≈ v_i

d1 ∈ D⁺(P1) → 同化で H[d1] → 1 → 質問が開く理由
d2 ∈ D⁻(P1) → 回答で O[d2] = 1 確定 → P1 は d2=0 と予測 → アノマリー
```

プレイヤーは d1 について聞いたつもりだが、回答から d2 の事実も「ついでに」分かる。記述素の連なりから質問を思いつくが、答えの一部が意外——これが偶然の開きである。

### ウミガメのスープでの具体例

> 「男がレストランでスープを注文したとき、以前にもスープを飲んだ経験がありますか？」

- effect: [(Fs-19: 以前にスープを飲んだ, 1), (Fs-26: 過去の体験と比較した, 1)]
- Fs-19 ∈ D⁺(P1) → H ≈ 1 で開く
- Fs-26 ∈ D⁻(P1) → 正解 yes → P1 にとってアノマリー
- ゲーム的解釈: 「飲んだことがあるか」は日常的な質問だが、「はい」と答えると「比較した」という情報が付随する。日常の食事（P1）では比較は想定外なので、違和感が生まれる

### 現状のデータの問題

現在の複数記述素質問:

| ID | effect | 構造 |
|----|--------|------|
| q13 | (Fs-18, 1), (Fs-20, 1) | 両方 P1 外（orphan）|
| q22 | (Fs-19, 1), (Fs-24, 1) | 両方 P1 D⁺ |
| q27 | (Fs-40, 1), (Fs-41, 1) | Fs-40 は P1 D⁻、Fs-41 は P1 外 |
| q44 | (Ft-09, 1), (Pt-2, 1) | Ft-09 は P1 D⁻ |
| q49 | (Ft-14, 1), (Ft-16, 1) | 両方 P1 外 |
| q55 | (Ft-29, 1), (Pt-6, 1) | Ft-29 は P1 D⁻ |

**「P1 D⁺ + P1 D⁻」の組み合わせを持つ質問がない。** 偶然の開きが機能しない原因はここにある。

## H の動き方の検討

### 現在の H 移動経路

| 経路 | 仕組み | D⁻ を正解方向に動かせるか |
|------|--------|--------------------------|
| 同化 | R(P) に沿って P の予測方向に押す | No（D⁻ は 0 に向かう）|
| 直接回答 | 質問回答で H[d] = v | No（質問が開かないと回答不可）|
| Ps 初期設定 | 問題文の既知事実 | No（D⁺ 方向のみ）|
| パラダイムシフト後 | 新パラダイムで同化 | Yes だがシフト自体が起きない |

### 結論

H の動き方だけでは D⁻ 記述素の H を正解方向に動かす経路がない。

## 全体の結論

1. 現在のデータ構造では、P1 からのアノマリー発生は**原理的に不可能**
2. 原因は**質問データの構造**にある（エンジンの問題ではない）
3. 解決策: 質問の effect に **D⁺ 記述素と D⁻ 記述素を混在させ**、偶然の開きを可能にする
4. エンジン変更は不要。質問データの ans_yes / ans_no の設計で対応可能
5. ただし、質問のゲーム的な自然さ（「なぜこの質問で両方の情報が得られるか」）の検討が必要

## 偶然の開きが機能した後の流れ

```
偶然の開きで P1 にアノマリー発生
  → tension > THRESHOLD → パラダイムシフト（P1 → P2）
  → P2 同化で新しい方向に H が動く
  → P2 関連の質問が開く
  → P2 で探索が進む
  → P2 でもアノマリー蓄積 → P3 へ …
  → 最終的に P5(=T) に到達
```

最初のアノマリーさえ発生すれば、以降はパラダイムシフト → 新同化 → 新質問開放の連鎖で進行する。偶然の開きは「最初のトリガー」として機能する。

## 次のステップ

- 質問設計の見直し: D⁺ + D⁻ 混在の複数記述素質問を設計する
- 各パラダイム遷移（P1→P2, P2→P3, ...）について、偶然の開きが存在することを確認する
- game_simulation.py で遷移が機能することを検証する

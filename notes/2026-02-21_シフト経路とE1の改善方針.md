# シフト経路と E1 の改善方針

## テーマ 2: alignment 関数の変更

### 問題

現在の alignment(O, P) は観測 O との一致率を測る。P_T は全観測と一致するため常に alignment = 1.0。部分観測では同点が多発し、辞書走査順で偶然にシフト先が決まっている。

### 方針: H ベースの alignment

```
alignment_h(H, P) = (Σ_{d∈D⁺} H[d] + Σ_{d∈D⁻} (1 - H[d])) / |D(P)|
```

- H は連続値（0〜1）なので同点が実質的に発生しない
- 同化により H は現パラダイムの予測方向に押されているため、構造的に近いパラダイムが自然に高スコアになる（明示的な proximity パラメータ不要）
- 未観測・未同化の記述素は H[d] = 0.5 で中立的に寄与 → D(P) が大きいだけでは有利にならない
- 観測が蓄積すると H が真値に収束し、P_T が自然に最大になる → 跳躍は情報量が十分なときにのみ発生

### ステータス

実装合意済み。engine.py の alignment 関数を変更する。

## テーマ 3: 同化接続性

### 問題

パラダイムシフト後に同化で新しい質問が開かない（bar_man で全シフトで発生）。R(P) のターゲットが全て観測済みであり、新たに開く質問がない。

### 分析

- エンジンのバグではなく、データ設計（記述素空間）の問題
- 内部構造アルゴリズム A 自体は正しい。入力となる空間の豊かさが不足している
- 評価スクリプト shift_path.py で各シフトの接続性を定量的に検証可能

### E1 の改善方針

現在の E1 に不足しているもの:

1. **Fs×Ft 合成の意識的強化**: Step 4 の合成が無差別で、架け橋候補となる Fs×Ft 合成が十分に生まれない可能性がある
2. **部分的理解の記述素**: Fs（表層）と Ft（真相）の中間にあたる「一歩近づいた理解」の記述素。中間パラダイムの固有領域の素材になる

これらが満たされれば、後段の内部構造構成で R(P) が自然に接続性を持つ空間が得られる。

### 対応方針: E2 の作成

E1 の出力を入力とし、空間の豊かさを補強する新アルゴリズム E2 を作成する。

**新規ルール:**

1. **架け橋合成**: Fs×Ft の意味的関連ペアを重点的に合成し、パラダイム間の架け橋となる記述素を生成する。共通規則「合成」の無差別な全ペア適用に対し、Fs×Ft に焦点を当てる。
2. **部分的理解生成**: Fs（表層）と Ft（真相）の中間にあたる記述素を生成する。「真相そのものではないが、表層よりも一歩真相に近い理解」を表す。中間パラダイムの固有領域の素材になる。

**E2 アルゴリズム:**

- 入力: E1 の出力（記述素空間 F）
- Step 1: 架け橋合成を適用（共有記述素・架け橋候補の強化）
- Step 2: 部分的理解生成を適用（中間パラダイムの固有領域の素材）
- 出力: 豊かさを補強された記述素空間 F'

完全な解決は反復的アルゴリズム導入時に行う。

### 対応方針: Q2 の作成

Q1 は記述素空間とパラダイム群を入力とするが、内部構造（D⁺, D⁻, R(P)）の情報を活用していない。Q 生成時にはこれらが利用可能であり、同化接続性をより直接的に保証できる。

**新規ルール:**

1. **フェーズ到達保証**: 各パラダイム P_i（init 以降）について、P_i へのシフト後にのみ開く質問が存在することを保証する。具体的には、P_{i-1} の同化では H が正解値から離れ、P_i の同化で近づく effect 記述素を持つ質問が必要。
2. **同化接続性検証**: R(P_i) の到達可能ターゲットが、未回答質問の effect に含まれることを検証する。不足する場合、質問の effect 設計を見直す。

**Q2 アルゴリズム:**

- 入力: 記述素空間、パラダイム群、内部構造（D⁺, D⁻, R(P)）
- Q1 の手順に加え、以下を追加:
  - 各シフト P_i → P_{i+1} について flip 記述素（予測が反転する記述素）を特定
  - flip 記述素を effect に含む質問の存在を確認・生成
  - R(P_{i+1}) のターゲットと質問 effect の接続性を検証
- 出力: 同化接続性が保証された質問群

## 補足: 初期質問グループ

初期質問がパラダイムの全領域をカバーすると、固有記述素の余地がなくなりボトルネックになりうる。質問生成や内部構造の検討時に注視する。

## 評価スクリプト

- shift_path.py: テーマ 2・3 の検証（alignment 順序、同化接続性）
- common.py: --data 引数でデータファイル切り替え対応済み

# 遷移駆動集合によるシフト方向の測定

## 背景

シフト方向検証（shift_direction.py）はメインパスの各遷移を固定順序（safe→anomaly）でシミュレーションする。しかしプレイヤーは質問を自由に選ぶため、特定の回答順序に依存した検証ではシフト方向の保証として不十分。

必要なのは、「どの質問群が選ばれれば遷移するか」というパラダイム間の構造的な関係性の測定であり、シミュレーションではなく P_pred の比較による静的分析で実現できる。

## 基本的な考え方

遷移 (P_i, P_{i+1}) に対して、Q(P_i) の各質問を P_pred の比較だけで分類する。質問 q の effect(q) の各記述素 (d, v) について 2 軸で判定する:

- **P_i にアノマリーを生むか**: P_i.P_pred(d) ≠ v
- **P_{i+1} と整合するか / 矛盾するか**: P_{i+1}.P_pred(d) = v / ≠ v

## 質問レベルの量

各質問 q ∈ Q(P_i) について:

- **anomaly_count(q)** = |{(d,v) ∈ effect(q) | P_i.P_pred(d) ≠ None かつ P_i.P_pred(d) ≠ v}|
- **support(q)** = |{(d,v) ∈ effect(q) | P_{i+1}.P_pred(d) = v}|
- **oppose(q)** = |{(d,v) ∈ effect(q) | P_{i+1}.P_pred(d) ≠ None かつ P_{i+1}.P_pred(d) ≠ v}|
- **net_direction(q)** = support(q) - oppose(q)

## 質問の 4 分類

anomaly_count と net_direction の 2 軸で分類する:

| | net_direction > 0 | net_direction ≤ 0 |
|---|---|---|
| **anomaly_count > 0** | 遷移駆動 | 駆動・逆方向 |
| **anomaly_count = 0** | 方向支持 | 方向反対 or 中立 |

- **遷移駆動**: P_i を壊しつつ P_{i+1} を支持する。理想的な質問
- **駆動・逆方向**: P_i を壊すが P_{i+1} に向かわない。別パラダイムへのシフトリスク
- **方向支持**: tension には寄与しないが P_{i+1} の alignment を高める
- **方向反対 / 中立**: 遷移 (P_i, P_{i+1}) に寄与しない、または逆方向に寄与する

## 集合レベルの指標

### 指標 1: 遷移方向スコア

Q(P_i) 全体が P_{i+1} 方向にどれだけ偏っているかを測る。

**遷移方向スコア(P_i, P_{i+1})** = Σ net_direction(q) / Σ (support(q) + oppose(q))　（全 q ∈ Q(P_i)）

- +1 に近い: Q(P_i) が全体的に P_{i+1} 方向
- 0 付近: 支持と不支持が拮抗
- 負: P_{i+1} と逆方向に偏っている

### 指標 2: 駆動率

アノマリー質問のうち正しい方向を向いている割合。

**駆動率(P_i, P_{i+1})** = |遷移駆動| / (|遷移駆動| + |駆動・逆方向|)

- 高い: アノマリーに遭遇するたびに自然に P_{i+1} へ向かう
- 低い: アノマリーが P_{i+1} 以外のパラダイムを支持するリスク

### 2 軸による診断

| 遷移方向スコア | 駆動率 | 診断 |
|---|---|---|
| 高 | 高 | 頑健な遷移。質問選択に依存せず P_{i+1} に向かう |
| 高 | 低 | 方向は正しいがシフト発動が不安定 |
| 低 | 高 | シフトは起きるが方向が拮抗している |
| 低 | 低 | 遷移が脆弱。質問設計の見直しが必要 |

## 遷移の十分性

遷移駆動集合のサイズ > threshold(P_i) であれば、プレイヤーがこの集合内の質問を選ぶだけで遷移が成立する見込みが高い。

遷移駆動集合が大きければ、プレイヤーの質問選択に余裕がある。小さければ、特定の質問を選ばない限り正しい遷移が起きない。

## shift_direction.py との関係

shift_direction.py（既存）は特定順序でのシミュレーションによる動的検証。本分析は P_pred の比較による静的検証。両者は相補的であり、別物として位置づける。

- **静的分析（本稿）**: 質問集合の構造的な方向性を測る。質問設計の品質指標
- **動的検証（shift_direction.py）**: 特定の回答順序でのシフト結果を確認する。ゲーム進行の検証

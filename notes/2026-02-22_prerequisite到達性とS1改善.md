# prerequisite 到達性の問題と S1 改善

## 経緯

前提事実（prerequisites）を両データセットに適用し anomaly_discovery で検証したところ、turtle_soup の q101 が発掘不可能と判定された（28/29）。

q101:「過去にスープを飲まされたことは、人肉と関係がありますか？」
prerequisites: [Fs-27]（誰かからスープを飲まされた）

### 原因

Fs-27 が O に入る経路がなかった。

- Fs-27 を effect に含む質問は q21（prerequisites なし）と q25（prerequisites: [Fs-26]）
- q21 の open 条件: abs(H[Fs-27] - 1) < EPSILON → H[Fs-27] ≈ 1 が必要
- Fs-27 は P1 の D(P) に含まれない → H[Fs-27] の初期値は 0.5
- Fs-27 を target とする R(P) 関係がどのパラダイムにも存在しない
- → 同化で H[Fs-27] を動かす経路がない → q21 がオープンしない → Fs-27 が O に入らない

### 誤った対処

q101 の prerequisite を Fs-27 → Fs-26 に変更して検証を通した。

**問題点**:
- 質問テキストは「飲まされた」= Fs-27 の内容を明示的に前提としている
- Fs-26（以前にスープを飲んだ）では「飲まされた」の前提として不十分
- prerequisites は質問テキストから導出される意味的制約であり、到達不能を理由に緩めてはならない
- 検証 NG に対して「ゲート条件を緩めて通す」のは S1 の対処法のいずれにも該当しない

### 正しい対処

S1 Step 5b の構造的対処として、P2 の R(P) に Fs-26 → Fs-27（w=0.8）関係を追加した。

意味的妥当性: P2（過去の味覚体験との結びつき）の文脈で、以前にスープを飲んだ事実（Fs-26）は誰かから飲まされた可能性（Fs-27）を示唆する。

発掘経路:
1. Step 32: q63 回答 → Fs-26 が O に入る
2. Step 33: q65 回答 → P1→P2 シフト → Fs-26 ∈ O と Fs-26→Fs-27 関係により同化発火 → H[Fs-27]: 0.500 → 0.900 → q21 がオープン
3. Step 42: q21 回答 → Fs-27 が O に入る → q101 の prerequisites 充足 → q101 がオープン

## アルゴリズムの改善

### 1. S1 Step 5b: 分析項目 4 の追加

既存の分析項目 1-3 は effect の H 値到達性に焦点を当てているが、prerequisite 由来の発掘不可ケースがカバーされていなかった。

追加した分析項目:
> 4. 当該質問の prerequisites の各記述素 d について、d が O に入るための経路が確保されているか
>    - d を effect に含む質問がオープンするか（H 値の到達性）
>    - その質問自体が prerequisites を持つ場合、その連鎖が到達可能か

対処の原則:
- 構造的対処（R(P) 関係追加、中間質問追加）を第一選択とする
- prerequisites を緩めること（テキストを変えずに prerequisite のみ変更）は禁止
- 構造的対処が不可能な場合は、質問テキストの修正（Q1 Step 2 への差し戻し）または質問の削除

### 2. Q1 Step 7 と S1 Step 5b の関係の明確化

Q1 Step 6（前提事実の割り当て）は質問のオープン条件を厳しくするため、S1 が確保した発掘連鎖を壊す可能性がある。

追加した記述:
- Step 6 後に S1 Step 5b を再実行する必要性
- 統合アルゴリズムの反復ループ: S1 → Q1 Step 6 → S1 Step 5b（再検証）→ Q2 → ...

## 教訓

1. **検証 NG に対してゲート条件を緩めて通してはならない**。prerequisites は質問テキストの意味から導出される制約であり、データの意味的整合性は検証の通過より優先する。

2. **既存アルゴリズムの対処法を先に検討する**。S1 Step 5b の構造的対処（R(P) 関係追加、中間質問追加等）は、まさにこのケースに適用可能だった。

3. **「検証が通ること」と「正しいこと」は異なる**。形式的な検証パスは必要条件であって十分条件ではない。データの意味的整合性を犠牲にした検証パスは無意味。

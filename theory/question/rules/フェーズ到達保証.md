# フェーズ到達保証

## 概要

各パラダイム P_i（init 以降）について、P_i へのシフト後にのみ開く質問が存在することを保証する規則。

パラダイムシフト後に新しい質問が開かなければゲームが停滞する。この規則は、各シフトが新たな探索の機会を生むことを質問設計の段階で保証する。

## 背景

エンジンの質問オープン条件において、質問が「開く」条件は O + R(P) のグラフ到達性に基づく。質問の effect 記述素が、Consistent または Anomaly から R(P) 経由で到達可能であるときに質問がオープンする。

パラダイムシフトにより P が変わると、R(P) の構造と P_pred が変化するため、到達可能な記述素の範囲が変わる。P_{i-1} と P_i で予測が反転する記述素（flip 記述素）は、シフトによって Consistent/Anomaly の分類が変わるため、シフト後にオープン状態が変化する質問の候補となる。

## 定義

**flip 記述素**: パラダイム P_i と P_{i+1} について、`prediction_i(d) ≠ prediction_{i+1}(d)` となる記述素 d を `flip(P_i, P_{i+1})` と定義する。

## 手順

1. メインパスの各遷移 P_i → P_{i+1} について、flip 記述素 `flip(P_i, P_{i+1})` を特定する

2. 各 flip 記述素 d について、以下を確認する:
   - d を effect に含む質問が存在すること
   - その質問の正答方向（ans_yes/ans_no による effect の値）が P_{i+1} の予測方向と一致すること
   - すなわち、P_{i+1} での R(P) 到達性により質問がオープンする条件が整うこと

3. 条件を満たす質問が存在しない flip 記述素がある場合:
   - 当該 flip 記述素を effect に含む質問を新規に生成する
   - または既存の質問の effect に当該 flip 記述素を追加する

4. 各遷移について、少なくとも 1 つの flip 記述素に対応する質問が存在することを確認する

## 検証条件

```
∀ i ∈ メインパスの遷移:
  ∃ d ∈ flip(P_i, P_{i+1}):
    ∃ q ∈ 質問群:
      d ∈ effect(q) かつ effect(q)[d] == prediction_{i+1}(d)
```

## 層間連鎖性（L3-7）との関係

フェーズ到達保証は flip 記述素に着目した静的な保証である。一方、L3-7（層間連鎖性）は R(P) の到達性に基づく層間接続の定量評価であり、フェーズ到達保証よりも広い範囲（全層遷移）を対象とする。

フェーズ到達保証が各遷移で最低限の質問オープンを保証し、L3-7 がパラダイム内部の層間接続の品質を定量的に評価する、という補完関係にある。

## 備考

- この規則は Q2 のフェーズ到達保証ステップで適用される
- 初期質問グループがパラダイムの全記述素をカバーしている場合、flip 記述素が全て初期質問で消費され、シフト後に開く質問がなくなるリスクがある。初期質問グループの設計時にこの点を考慮する

# フェーズ到達保証

## 概要

各パラダイム P_i（init 以降）について、P_i へのシフト後にのみ開く質問が存在することを保証する規則。

パラダイムシフト後に新しい質問が開かなければゲームが停滞する。この規則は、各シフトが新たな探索の機会を生むことを質問設計の段階で保証する。

## 背景

エンジンの同化メカニズムにおいて、質問が「開く」条件は `H[d] ≈ v`（H の値が正解値に近い）である。パラダイムシフト後の同化は R(P) に沿って H を動かすが、動く方向が質問の正解方向と一致する場合にのみ質問が開く。

P_{i-1} と P_i で予測が反転する記述素（flip 記述素）は、シフトによって H の動く方向が変わるため、シフト後にのみ開く質問の候補となる。

## 定義

**flip 記述素**: パラダイム P_i と P_{i+1} について、`prediction_i(d) ≠ prediction_{i+1}(d)` となる記述素 d を `flip(P_i, P_{i+1})` と定義する。

## 手順

1. メインパスの各遷移 P_i → P_{i+1} について、flip 記述素 `flip(P_i, P_{i+1})` を特定する

2. 各 flip 記述素 d について、以下を確認する:
   - d を effect に含む質問が存在すること
   - その質問の正答方向（ans_yes/ans_no による effect の値）が P_{i+1} の予測方向と一致すること
   - すなわち、P_{i+1} での同化が H[d] を正解方向に動かすこと

3. 条件を満たす質問が存在しない flip 記述素がある場合:
   - 当該 flip 記述素を effect に含む質問を新規に生成する
   - または既存の質問の effect に当該 flip 記述素を追加する

4. 各遷移について、少なくとも 1 つの flip 記述素に対応する質問が存在することを確認する

## 検証条件

```
∀ i ∈ メインパスの遷移:
  ∃ d ∈ flip(P_i, P_{i+1}):
    ∃ q ∈ 質問群:
      d ∈ effect(q) かつ effect(q)[d] == prediction_{i+1}(d)
```

## 備考

- この規則は Q1 の Step 6（検証）を強化するものとして位置づけられる
- 初期質問グループがパラダイムの全記述素をカバーしている場合、flip 記述素が全て初期質問で消費され、シフト後に開く質問がなくなるリスクがある。初期質問グループの設計時にこの点を考慮する

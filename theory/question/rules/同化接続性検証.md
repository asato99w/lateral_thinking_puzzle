# 同化接続性検証

> **適用保留**: 推定 O が実際のゲーム状態と異なりうるため、本検証の信憑性が不明。必要条件でも十分条件でもない静的近似であり、適用を保留する。到達パス検証（L2-5）と構造的品質診断（L3-6/L3-7）が代替的な検証手段を提供する。

## 概要

各パラダイムシフト後に、同化メカニズムが質問を開くために必要な接続性が成立することを検証・保証する規則。

R(P) のターゲット記述素が未回答質問の effect に含まれていなければ、同化が H を動かしても新たな質問は開かない。この規則は質問設計時にその接続性を検証し、不足があれば質問設計の見直しを促す。

## 背景

同化の流れ:

```
1. 観測済み記述素 d ∈ O のうち、P_pred(P_{i+1}, d) ∈ {0, 1} かつ P_pred(P_{i+1}, d) == O[d] となるものを同化起点とする
2. 同化起点から R(P_{i+1}) の関係を辿り、ターゲット記述素 t の H[t] を P_{i+1} の予測方向に動かす
3. t が質問 q の effect に含まれ、O + R(P) の到達性条件を満たすと、q が open になる
```

この流れが成立するためには、ターゲット記述素 t が未回答質問の effect に含まれている必要がある。

## 手順

1. 各遷移 P_i → P_{i+1} について、以下を計算する:
   - P_i フェーズ終了時の推定観測 O_i
   - 同化起点: `{d ∈ O_i : P_pred(P_{i+1}, d) ∈ {0, 1} かつ P_pred(P_{i+1}, d) == O_i[d]}`
   - R(P_{i+1}) で同化起点から到達可能なターゲット記述素 T_reach

2. T_reach の各ターゲット記述素 t について、以下を確認する:
   - t を effect に含む未回答質問 q が存在すること
   - q の effect[t] の値（正解方向）が P_pred(P_{i+1}, t) と一致すること
   - すなわち、同化が H[t] を正解方向に動かし、q を開く可能性があること

3. 条件を満たす質問が存在しない場合:
   - T_reach のターゲット記述素を effect に含む質問を新規に生成する
   - または既存の質問の effect に当該ターゲット記述素を追加する
   - または R(P_{i+1}) の関係を見直し、同化起点から未回答質問の effect 記述素への経路を確保する

## 検証条件

```
∀ i ∈ メインパスの遷移:
  同化起点 S_i = {d ∈ O_i : P_pred(P_{i+1}, d) ∈ {0, 1} かつ P_pred(P_{i+1}, d) == O_i[d]}
  |S_i| > 0                                    ... (同化の発火条件)
  T_reach = {t : ∃ s ∈ S_i, (s, t, w) ∈ R(P_{i+1})}
  ∃ t ∈ T_reach:
    ∃ q ∈ 未回答質問:
      t ∈ effect(q) かつ effect(q)[t] == P_pred(P_{i+1}, t)
                                                ... (質問開放条件)
```

## 備考

- この規則は shift_path.py（評価スクリプト）の検証ロジック（テーマ 3）を質問生成段階に活用したもの
- 同化起点の存在は質問設計だけでなくパラダイムの P_pred 設計にも依存するため、内部構造構成と連携して検討する必要がある
- 完全な保証は反復的アルゴリズム（質問生成 → 検証 → 修正）の導入により達成される

# 質問生成アルゴリズム Q2: 内部構造活用型

## 概要

Q1 の手順に加え、パラダイムの内部構造（P_pred, R(P)）の情報を活用して、パラダイムシフト後のゲーム進行を保証する質問群を生成するアルゴリズム。

Q1 は記述素空間とパラダイム群を入力とするが、内部構造の情報を活用していない。Q2 はこれらの情報を用いて、各シフトにおけるフェーズ到達と同化接続性を質問設計段階で保証する。

## 入力

- 記述素空間（記述素展開アルゴリズムの出力）
- パラダイム群（メインパス、サブパス、各パラダイムの記述素を含む）
- 内部構造（各パラダイムの P_pred, R(P)）

## 出力

- 質問群（ans 写像、役割、大区分情報付き。フェーズ到達と同化接続性が保証されたもの）

## 使用規則

Q1 の全規則（前提事実を含む）に加え:

- フェーズ到達保証
- 同化接続性検証

## 手順

### Step 1〜6: Q1 の手順

Q1 の Step 1（質問候補の網羅的生成）〜 Step 6（前提事実の割り当て）をそのまま実行する。

### Step 7: flip 記述素の特定

メインパスの各遷移 P_i → P_{i+1} について、flip 記述素を特定する。

```
flip(P_i, P_{i+1}) = {d ∈ D(P_i) ∩ D(P_{i+1}) : prediction_i(d) ≠ prediction_{i+1}(d)}
```

各遷移の flip 記述素を記録する。

### Step 8: フェーズ到達保証

規則「フェーズ到達保証」を適用する。

1. 各遷移 P_i → P_{i+1} について、flip 記述素を effect に含む質問の存在を確認する
2. 不足がある場合、flip 記述素を effect に含む質問を新規に生成する
3. 生成した質問は P_{i+1} フェーズの探索質問として役割を付与する

### Step 9: 同化接続性検証

> **適用スキップ**: 同化接続性検証は推定 O に基づく近似の信憑性が未確定のため適用を保留する。到達パス検証（L2-5）と構造的品質診断（L3-6/L3-7）が代替的な検証手段を提供する。

### Step 10: 検証

Q1 の検証項目に加え、以下を確認する:

- 各遷移に flip 記述素対応の質問が存在すること（フェーズ到達条件）
- 初期質問グループが flip 記述素を過剰にカバーしていないこと（シフト後の質問開放余地）

不足がある場合、Step 8 に戻る。

## 備考

- Q2 は Q1 の上位互換として設計されている。Q1 の手順を包含し、内部構造情報を活用する追加ステップを加えたもの
- 同化接続性の完全な保証には、質問の effect と R(P) のターゲットの整合性が必要であり、これは内部構造構成アルゴリズムとの連携が前提となる
- 完全な保証は反復的プロセス（Q2 → 検証 → 修正 → 再検証）により達成される。Q2 の単独実行では「検出と方針提示」までが確実な範囲である
- Q2 の Step 8〜9 で追加・変更された質問についても、前提事実の割り当て（Q1 Step 6）が必要な場合は適宜設定する

# パラダイムシフトの機構

## 概要

パラダイムシフトは、現在のパラダイムが観測を説明しきれなくなったときに発生する。この機構は二つの独立した判定から構成される。

1. **シフト発動**: 現在のパラダイムに対するアノマリーの蓄積が閾値を超えたか（いつシフトするか）
2. **シフト先決定**: 候補パラダイムの中で観測を最もよく説明するものはどれか（どこにシフトするか）

これらは異なる目的を持つため、それぞれ独立した関数として定義する。

## 緊張関数 tension(O, P)

現在のパラダイム P に対するアノマリーの蓄積度を測る。

### 定義

**tension(O, P) = |{d ∈ O ∩ Conceivable(P) | P_pred(d) ≠ O(d)}|**

O の観測のうち、P の想起可能集合に含まれ、かつ P の予測と矛盾するもの（アノマリー）の数。

### 性質

- O は単調に拡大し、一度 O に入った記述素は除かれない。アノマリーの寄与は非負であるため、tension は**単調非減少**である。
- O と P のみから計算され、H に依存しない（客観的な判定）。
- Conceivable(P) に含まれない観測は tension に寄与しない。これにより、パラダイムの想起範囲外の観測が緊張を生むことはない。

### シフト発動条件

**tension(O, P_current) > threshold(P_current)**

threshold(P) はパラダイムごとに、完全確定 O* と Conceivable の固有・共有構造から導出される（下記参照）。

## 閾値の導出

**threshold(P) = |固有想起アノマリー(P)| + min_{P'} |共有想起アノマリー(P, P')|**

- **固有想起アノマリー**: Conceivable(P) に固有（他のどの Conceivable にも属さない）な記述素のうち、P_pred(d) ≠ O*(d) であるもの
- **共有想起アノマリー(P, P')**: Conceivable(P) ∩ Conceivable(P') 内で P_pred(d) ≠ O*(d) であるもの
- **min_{P'}**: 共有アノマリーが最小のパラダイムとの値を採用

### 根拠

- 固有想起アノマリーはパラダイム内で確実に観測される。少なくともこれが一通り崩れるまではシフトしない（早すぎるシフトの防止）
- min 共有アノマリーの加算により、最低1つのシフト先との共有アノマリーも観測された状態を保証する
- Conceivable(P) と O* から算出でき、質問の経路に依存しない

### 性質

- T（真理論を含むパラダイム）は anomalies(O*, T) = 0 であり、threshold は不要（シフト元にならない）
- 健全性条件（アノマリーの単調減少）が満たされていれば、メインパスの各パラダイムに対して閾値が定まることが保証される

## 整合性関数 alignment(H, P)

候補パラダイム P が暫定理論 H とどれだけ整合するかを測る。

### 定義

**alignment(H, P) = (Σ_{d: P_pred(d)=1} H(d) + Σ_{d: P_pred(d)=0} (1 - H(d))) / |P_pred(P)|**

P_pred(d)=1 の記述素は H(d) が 1 に近いほど、P_pred(d)=0 の記述素は H(d) が 0 に近いほど、alignment が高くなる。P_pred 全体（Conceivable に限定しない）を対象とする。

### 性質

- H は連続値（0〜1）であるため、同点が実質的に発生しない。
- 同化により H は現パラダイムの予測方向に押されているため、構造的に近いパラダイムが自然に高スコアになる。
- 未観測・未同化の記述素は H(d) = 0.5 で中立的に寄与する。
- 観測が蓄積すると H が真値に収束し、T が自然に最大になる。跳躍は情報量が十分なときにのみ発生する。

## 説明力関数 explained_o(O, P)

パラダイム P が観測 O をどれだけ正しく説明するかを測る。

### 定義

**explained_o(O, P) = |{d ∈ O | P_pred(d) ≠ None かつ P_pred(d) = O(d)}|**

P_pred 全体（Conceivable に限定しない）を対象とし、O の記述素のうち P_pred が正しく予測するものの数。

### シフト先の決定

シフト候補は、現パラダイムより高い説明力を持つパラダイムに限定する。

**候補 = { P' | explained_o(O, P') > explained_o(O, P_current) }**

**P_new = argmax_{P' ∈ 候補} alignment(H, P')**

候補が空の場合は危機状態とし、P_current を維持して継続する。

P_current は候補に含まれない。explained_o による絞り込みは P_pred 全体を用いるため、Conceivable 外の論理的予測も含む広い視野での比較となる。alignment は候補内での選択に用いられ、H が反映するプレイヤーの認知状態に最も整合するパラダイムが選ばれる。

## シフト手続き

1. 質問への回答により O を更新する
2. 同化（現在のパラダイムの関係構造に基づく H の伝播）
3. tension(O, P_current) > threshold(P_current) であればシフト判定へ
4. 候補 = { P' | explained_o(O, P') > explained_o(O, P_current) }
5. 候補の中で alignment(H, P') が最大の P_new にシフトし、P_new の関係構造で H を再構成する
6. 候補が空ならば P_current を維持（危機状態）

## 共有質問と架橋質問の役割

二つの質問タイプがシフト機構において相補的に機能する。

- **架橋質問**: 効果が複数パラダイムの固有想起記述素にまたがる。現在のパラダイムの Conceivable(P) 内で矛盾する効果を含みうるため、アノマリーを蓄積し、tension を高める。シフトを**引き起こす**。
- **共有質問**: 効果が共有想起記述素のみに属する。現在のパラダイムと矛盾しないため tension は変化しないが、シフト先の alignment を高める。シフトの**方向を決定づける**。

## データの健全性条件

### 完全確定におけるアノマリーの単調減少

メインパスのパラダイム列 P₁ → P₂ → ... → T に対して、完全確定（全記述素が O* または R* に振り分けられた状態）のもとでのアノマリー数が単調に減少すること。

**anomalies(O*, P₁) > anomalies(O*, P₂) > ... > anomalies(O*, T) = 0**

- P₁ はアノマリーが最も多い → 最初にシフトが発生する
- T はアノマリーがゼロ → P(O | T) = 1 が構造的に保証される
- 各パラダイムは前のパラダイムより少ないアノマリーを持つ → シフトのたびに安定性が増す

この条件はデータ設計時に検証すべき構造的要件である。

### 正解予測の包含（eo 単調性の構造的保証）

メインパスの連続するパラダイム P_i, P_{i+1} について、O* 上で P_i が正しく予測する記述素の集合が P_{i+1} の部分集合であること。

**{ d ∈ O* | P_pred_i(d) = O*(d) } ⊆ { d ∈ O* | P_pred_{i+1}(d) = O*(d) }**

この包含関係が成り立てば、O の任意の部分集合に対して explained_o(O, P_{i+1}) ≥ explained_o(O, P_i) が保証される。シフト先候補の eo フィルタ（strict >）を通過するには、P_{i+1} のみが正しく予測する記述素が O に追加される必要がある。

### シフトドライバーの到達性

メインパスの連続するパラダイム P_i, P_{i+1} について、P_{i+1} の **eo ドライバー記述素**（P_{i+1} が正しく予測し、P_i が不正解または予測なし）のうち、P_i が active のときにオープン可能な質問で到達できるものが 1 つ以上存在すること。

**定義**

- **eo ドライバー記述素**: D_driver(P_i, P_{i+1}) = { d ∈ O* | P_pred_{i+1}(d) = O*(d) かつ (P_pred_i(d) ≠ O*(d) or P_pred_i(d) = None) }
- **到達可能ドライバー**: ドライバー記述素 d を effect に含む質問 q が存在し、q の参照記述素が全て Conceivable(P_i) 内にある
- **検証条件**: |到達可能ドライバー| ≥ 1

**根拠**

シフト先決定は eo フィルタ（explained_o(O, P') > explained_o(O, P_current)）を通過する必要がある。正解予測の包含が成り立つ場合、eo 差分は P_{i+1} のドライバー記述素が O に追加されたときにのみ生じる。P_i active 時にドライバーに到達する質問がなければ、ゲーム進行中に eo(P_{i+1}) > eo(P_i) が実現せず、P_{i+1} はシフト候補にならない。

**不充足時の影響**

P_{i+1} がスキップされ、P_i → P_{i+2} への直接遷移が発生する。特に P_{i+2} のドライバーが P_i からオープン可能な場合、P_{i+1} は構造的にスキップが確定する。

**不充足時の対処**

共有 Conceivable 内（Conceivable(P_i) ∩ Conceivable(P_{i+1})）にドライバー記述素を確保する。具体的には:

1. P_{i+1} の D(P) 配置の見直し: 共有 Conceivable の記述素で、P_{i+1} が正しく予測し P_i が不正解となるよう D⁺/D⁻ を調整する
2. Conceivable の拡張: P_i の Conceivable に P_{i+1} のドライバー記述素の一部を追加する（パラダイムの意味的整合性に注意）

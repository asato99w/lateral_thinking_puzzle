# 補充検証：S1 適用

入力:
- 形式化（形式化.md）に基づく JSON データ（app/poc/data/turtle_soup.json）
- anomaly_discovery.py の検証結果

## 検証結果

### 静的検証（opening_reach）

既存の検証で OK。

### 動的検証（anomaly_discovery）

#### Part 1: 初期オープン汚染チェック

init_questions のロジック修正（anomaly effect を含む質問を除外）により **OK**。

#### Part 2: 発掘連鎖シミュレーション

29 件中 28 件が発掘可能。**1 件が発掘不可（q90）**。

## 不足診断

### q90: 類型 D（発掘連鎖の断絶）

| 項目 | 値 |
|------|-----|
| 質問 | 男の過去に何か重大な出来事がありましたか？ |
| 正答 | はい |
| effect | (Fs-61, 1) |
| Fs-61 の所属 | P1: D⁻(pred=0)、P2: D⁺(pred=1)、他: outside |
| open 条件 | H[Fs-61] ≈ 1 |

**発掘不可の原因**:

1. q90 は単一記述素質問（偶然の開きの構造がない）
2. Fs-61 は P1 の D⁻ であり、P1 の同化で H[Fs-61] → 0 に押される
3. Fs-61 が D⁺ のパラダイム (P2) をゲーム進行が経由しない（P1→S2→P3 の経路）
4. P2 の relations にも Fs-61 への到達パスがない

## 対処

### q90 の effect 修正（偶然の開き構造の付与）

q90 の effect に開放記述素を追加し、偶然の開きの構造にする。

**修正前**:
- text: 男の過去に何か重大な出来事がありましたか？
- effect: [(Fs-61, 1)]

**修正後**:
- text: 男の過去の体験が、今回のレストラン訪問と関係していますか？
- ans_yes: [(Fs-05, 1), (Fs-61, 1)]
- ans_no: [(Fs-05, 0), (Fs-61, 0)]
- ans_irrelevant: [Fs-05, Fs-61]

**開放記述素の選定理由**:

Fs-05「男はこのレストランに特定の目的を持って来た」(P1 D⁺, T=1)

- P1 の同化で H[Fs-05] → 1 に動くため、q90 の open 条件を満たす
- 質問内容との意味的関連: 「過去の体験」と「レストラン訪問」の関係を問う質問で、来店目的(Fs-05)と過去の重大事(Fs-61)の両方が自然に含まれる
- 回答「はい」のゲーム的解釈: 来店の目的が過去の体験に関係している、という情報が得られる。来店目的(safe)の確認のつもりで質問したら、過去の重大事(anomaly)の情報もついてきた

**init_questions への影響**:

修正後の q90 は effect に P1 の予測と一致する (Fs-05, 1) と矛盾する (Fs-61, 1) の両方を含むため、init_questions の新条件（矛盾 effect があれば除外）により初期オープンから除外される。→ OK

## 再検証

修正後に anomaly_discovery.py を再実行し、全 anomaly 質問の発掘可能性を確認する。

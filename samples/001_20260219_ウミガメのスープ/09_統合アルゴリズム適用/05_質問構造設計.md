# 質問構造設計（Phase 2）

使用規則: 質問構造設計
使用個別アルゴリズム: 質問構造設計アルゴリズム

## 適用概要

Phase 1 の出力（記述素空間 F'、パラダイム群の P_pred, R(P)）を入力とし、アノマリーからの逆算により各パラダイムの質問構造を設計する。

オープン条件の復習: エンジンの `open_questions` は以下でオープンを判定する:
- **3a（一致からの探索）**: 質問の effect 記述素 d が Consistent(O, P) からの R(P) 到達集合に含まれ、かつ P_pred(d) == effect 値
- **3b（違和感からの探索）**: 質問の effect 記述素 d が Anomaly(O, P) からの R(P) 到達集合に含まれる

---

## Step 1: アノマリー目標設定

### P1（9 アノマリー）

| ID | P1予測 | T値 | アノマリー内容 | グループ |
|----|--------|-----|--------------|---------|
| Fs-06 | 0 | 1 | 過去の体験が関係 | 注文動機 |
| Fs-11 | 0 | 1 | スープ以外に興味なし | 注文動機 |
| Fs-12 | 0 | 1 | 特別な思い入れ | 注文動機 |
| Fs-15 | 0 | 1 | 注文に迷い | 注文動機 |
| Fs-16 | 0 | 1 | 期待と不安 | 注文動機 |
| Fs-18 | 0 | 1 | 一口で気づいた | 味覚反応 |
| Fs-19 | 0 | 1 | 味を確認するために飲んだ | 味覚反応 |
| Fs-20 | 0 | 1 | 味に驚いた | 味覚反応 |
| Fs-22 | 0 | 1 | やめた理由がある | 味覚反応 |

**シフト先 P2 の resolve 条件**: P2 は上記 9 個全てを P_pred=1 で解消。resolve >= N(P2) を確実に満たすには、少なくとも 2〜3 個のアノマリーを O に導入する質問が必要。

**完全性確認**: 9 個全てを effect でカバーする質問群が必要。

### P2（4 アノマリー）

| ID | P2予測 | T値 | アノマリー内容 |
|----|--------|-----|--------------|
| Fs-27 | 0 | 1 | 飲まされた体験 |
| Fs-30 | 0 | 1 | 確認結果が運命を決定づけた |
| Fs-35 | 0 | 1 | 死活問題 |
| Fs-36 | 0 | 1 | 過去の意味が変わった |

**シフト先 P3 の resolve 条件**: P3 は 4 個全てを解消。resolve >= N(P3)（おそらく 1〜2）。

### P3（2 アノマリー）

| ID | P3予測 | T値 | アノマリー内容 |
|----|--------|-----|--------------|
| D-04 | 0 | 1 | 嘘は男を守るため |
| Ft-50 | 0 | 1 | 過去に危機的状況 |

**シフト先 P4 の resolve 条件**: P4 は 2 個全てを解消。resolve >= N(P4)。

### P4（1 アノマリー）

| ID | P4予測 | T値 | アノマリー内容 |
|----|--------|-----|--------------|
| Ft-34 | 0 | 1 | 人肉は社会的タブー |

**シフト先 P5 の resolve 条件**: P5 が解消。resolve >= N(P5)（= 1）。

### S1（3 アノマリー）

| ID | S1予測 | T値 | アノマリー内容 |
|----|--------|-----|--------------|
| Fs-06 | 0 | 1 | 過去体験が関係 |
| Fs-12 | 0 | 1 | 特別な思い入れ |
| B-01 | 1 | 0 | 料理の専門家 |

行き止まり。B-01 の質問（「専門家か？」→答え: No）で即座にアノマリー発生。

### S2（5 アノマリー）

| ID | S2予測 | T値 | アノマリー内容 |
|----|--------|-----|--------------|
| Fs-13 | 1 | 0 | 注文時に恐怖 |
| Fs-18 | 0 | 1 | 一口で気づいた |
| Fs-19 | 0 | 1 | 味確認目的 |
| Fs-20 | 0 | 1 | 味に驚いた |
| B-02 | 1 | 0 | スープへの恐怖 |

行き止まり。B-02 の質問（「恐怖があるか？」→答え: No）で即座にアノマリー発生。

---

## Step 2: 認知的到達経路の逆算

### P1 の逆算

アノマリー質問は**混合効果構造**を取る: safe 記述素（P1=1, T=1）と anomaly 記述素（P1=0, T=1）を共に effect に持つ。safe 記述素により 3a でオープンし、anomaly 記述素が O に導入されてアノマリーとなる。

#### 注文動機グループ

```
[層0] Fs-14（あえて選んだ, safe）
  ↓ R(P1) 到達
[層1] Aq1-1: effect = {Fs-09(safe), Fs-11(anomaly)}
        「スープ以外に興味はなかったか」
        prereq: Fs-14 ∈ O
[層1] Aq1-2: effect = {Fs-14(safe), Fs-12(anomaly)}
        「スープに特別な思い入れがあるか」
        prereq: Fs-14 ∈ O
  ↓
[層2] Aq1-3: effect = {Fs-12(safe in P2 context), Fs-06(anomaly)}
        「来店に過去の体験が関係しているか」
        prereq: Fs-12 ∈ O
        ※ P1 では Fs-12 は anomaly だが、Fs-12 が O に入ったことで
          R(P1) の Fs-01→Fs-06 到達により 3a でオープン可能
[層1] Aq1-4: effect = {Fs-14(safe), Fs-15(anomaly), Fs-16(anomaly)}
        「注文に迷いや不安があったか」
        prereq: Fs-14 ∈ O
```

#### 味覚反応グループ

```
[層0] Fs-17（味を知覚, safe）, Fs-21（一口, safe）
  ↓ R(P1) 到達
[層1] Aq1-5: effect = {Fs-17(safe), Fs-19(anomaly)}
        「味を確認するために飲んだか」
        prereq: Fs-17 ∈ O
[層1] Aq1-6: effect = {Fs-17(safe), Fs-18(anomaly), Fs-20(anomaly)}
        「味に驚き、何かに気づいたか」
        prereq: Fs-17 ∈ O
[層1] Aq1-7: effect = {Fs-21(safe), Fs-22(anomaly)}
        「一口でやめた理由があるか」
        prereq: Fs-21 ∈ O
```

**完全性**: Aq1-1〜Aq1-7 で全 9 アノマリー記述素をカバー ✓

#### P1 の逆算 DAG

```
         Fs-01(safe,層0)    Fs-39(safe,層0)
         ├→ Fs-05(safe,層0)
         │  └→ Fs-14(safe,層0)
         │     ├→ Aq1-1 [Fs-11] ─────── 層1
         │     ├→ Aq1-2 [Fs-12] ─────── 層1
         │     │  └→ Aq1-3 [Fs-06] ──── 層2
         │     └→ Aq1-4 [Fs-15,Fs-16] ─ 層1
         └→ Fs-17(safe,層0) Fs-21(safe,層0)
            ├→ Aq1-5 [Fs-19] ─── 層1
            ├→ Aq1-6 [Fs-18,Fs-20] ── 層1
            └→ Fs-21→Aq1-7 [Fs-22] ─ 層1
```

### P2 の逆算

P1→P2 シフト後、P1 のアノマリー（Fs-06, 11, 12, 15, 16, 18, 19, 20, 22）は P2 の Consistent に転換。この拡張された Consistent 集合から P2 の新規記述素への到達が必要。

#### ゲート辺による接続

P2 で初めて概念に入る Fs-26（過去にウミガメのスープを飲んだ）が P2 の新規探索の起点。Consistent(O, P2) から Fs-26 への到達のために、ゲート辺 Fs-12 → Fs-26 が必要（後述 Step 3）。

#### 逆算

```
[ゲート] Fs-12(P1由来,Consistent) → Fs-26(P2 新規)
[層0-P2] Fs-26(過去に飲んだ, safe)
  ↓ R(P2): Fs-26→Fs-24, Fs-26→Fs-25
[層0-P2] Fs-24(判別基準), Fs-25(過去と関係)
  ↓ R(P2): Fs-24→Fs-38
[層0-P2] Fs-38(味の比較が鍵)
  ↓ R(P2): Fs-26→Fs-27(Rule2), Fs-38→Fs-35(Rule2)
[層1-P2] Aq2-1: effect = {Fs-26(safe), Fs-27(anomaly)}
          「過去に誰かから飲まされたか」
          prereq: Fs-26 ∈ O
[層1-P2] Aq2-2: effect = {Fs-34(safe), Fs-30(anomaly)}
          「確認結果が運命を決定づけたか」
          prereq: Fs-34 ∈ O
[層1-P2] Aq2-3: effect = {Fs-38(safe), Fs-35(anomaly)}
          「本物と偽物の区別が死活問題か」
          prereq: Fs-38 ∈ O
[層1-P2] Aq2-4: effect = {Fs-34(safe), Fs-36(anomaly)}
          「確認で過去の意味が変わったか」
          prereq: Fs-34 ∈ O
```

**完全性**: Aq2-1〜Aq2-4 で全 4 アノマリーをカバー ✓

#### P2 の逆算 DAG

```
Fs-12(P1由来) ──[gate]──→ Fs-26(層0-P2)
                            ├→ Aq2-1 [Fs-27] ──── 層1-P2
                            └→ Fs-24 → Fs-38
                               ├→ Aq2-3 [Fs-35] ── 層1-P2
                               └→ Fs-34
                                  ├→ Aq2-2 [Fs-30] ── 層1-P2
                                  └→ Aq2-4 [Fs-36] ── 層1-P2
```

### P3 の逆算

P2→P3 シフト後、P2 のアノマリー（Fs-27, 30, 35, 36）は P3 の Consistent に転換。特に Fs-27（飲まされた）が P3 の嘘フレームワークの入口。

#### 接続経路

R(P3) の既存辺で接続:
- Fs-27(Consistent) → Ft-23 → Ft-22 → Ft-37（嘘・隠蔽の連鎖）
- Fs-38(Consistent) → D-01 → D-02 → D-03 → D-05/D-06（嘘の論理構造）

```
[層0-P3] 嘘の構造を探索する質問群
  Ft-22(隠す意図), Ft-23(信じた), Ft-37(別の食材), D-01〜D-06
  ↓ R(P3): D-03→D-05, Fs-33→D-06
  全て safe（P3=1, T=1）
  ↓
[層1-P3] Aq3-1: effect = {D-03(safe), D-04(anomaly)}
          「嘘は男を守るためだったか」
          prereq: D-03 ∈ O
[層1-P3] Aq3-2: effect = {Fs-61(safe), Ft-50(anomaly)}
          「男は過去に危機的状況にいたか」
          prereq: Fs-61 ∈ O
```

**Fs-61 の到達性**: R(P2) に Fs-06→Fs-61 が存在。Fs-06 は P3 でも Consistent(=1)、Fs-61 は consistent_reach 内。

**完全性**: Aq3-1〜Aq3-2 で全 2 アノマリーをカバー ✓

### P4 の逆算

P3→P4 シフト後、D-04(嘘は守るため), Ft-50(危機的状況) が P4 の Consistent に転換。ここから遭難・極限状況の記述素への到達が必要。

#### ゲート辺による接続

Ft-50(Consistent) → Pt-1(遭難) がゲート辺として必要。Pt-1 は R(P4) の起点であり、ここから遭難の全容が展開される。

```
[ゲート] Ft-50(P3由来) → Pt-1(P4 新規)
[層0-P4] Pt-1(遭難), → Pt-2(食料), Pt-3(仲間の死) [R(P4) 追加辺]
  ↓ R(P4): Pt-1→Ft-01〜Ft-08, Ft-03→Ft-09→...
[層0-P4] 遭難の詳細を探索する質問群（大量）
  Ft-01〜Ft-33, Pt-4, Pt-5, Pt-7〜Pt-10
  ↓
[層1-P4] Aq4-1: effect = {Ft-28(safe), Ft-34(anomaly)}
          「その材料は社会的にタブーとされるものか」
          prereq: Ft-28 ∈ O
```

**Ft-28 の到達性**: R(P4) で Pt-6 周辺から Ft-28 に到達... だが Pt-6 は P4 では不定。代わりに D-07→Ft-28 (R(P4) に存在)。D-07 は P4=1 であり、Consistent(O, P4) 内の D-04(嘘は守るため)から D-07(極限食材) への到達が必要。

ゲート辺追加: D-04 → D-07 (w=0.8)。「守るため」→「極限で入手困難な食材」の認知的接続。

```
D-04(Consistent) → D-07(safe) → Ft-28(safe) → Aq4-1 [Ft-34]
```

**完全性**: Aq4-1 で唯一のアノマリーをカバー ✓

### S1 の逆算

S1 は行き止まり。B-01（専門家）が S1 の核心だが、T=0 であるため質問した瞬間にアノマリーとなる。

```
[層0-S1] Q_S1: effect = {Fs-24(safe in S1), B-01(anomaly: S1=1, T=0)}
          「男は料理の専門家か」
          prereq: なし
```

B-01=0 が O に入ると Anomaly(O, S1) が生じ、tension が増加。P1 の近傍としてシフト判定が再評価される。

### S2 の逆算

S2 も行き止まり。B-02（恐怖）が核心だが T=0。

```
[層0-S2] Q_S2: effect = {Fs-28(safe in S2), B-02(anomaly: S2=1, T=0)}
          「男はスープに恐怖を持っているか」
          prereq: なし
```

B-02=0 が O に入ると Anomaly(O, S2)。

---

## Step 3: 層構造への配置

### P1 の層構造

| 層 | 質問タイプ | 記述素 | 役割 |
|----|-----------|--------|------|
| 0 | 基本事実確認（safe のみ） | Fs-01, 02, 04, 05, 07, 08, 09, 14, 17, 21, 23, 29, 31, 33, 34, 39, 44 | 探索 |
| 0 | 否定仮説排除（safe のみ） | Fs-46〜Fs-50, Fs-51〜Fs-59 | 蓄積 |
| 1 | 注文動機のアノマリー質問 | safe + {Fs-11, 12, 15, 16} | 駆動 |
| 1 | 味覚反応のアノマリー質問 | safe + {Fs-18, 19, 20, 22} | 駆動 |
| 2 | 過去体験のアノマリー質問 | safe + {Fs-06} | 駆動 |

**初期オープン質問候補**（層 0 の部分集合、データ駆動で指定）:
- 食事の基本構造に関する質問（Fs-01, Fs-05, Fs-14 系）
- 飲食行動に関する質問（Fs-17, Fs-21 系）
- 自殺との因果に関する質問（Fs-39 系）
- 否定仮説排除（Fs-51〜Fs-59 系）

**横方向の広がり**: 層 0 に十分な質問数（10 問以上）があり、層 1 に 2 グループ（注文動機・味覚反応）が並列に到達可能。ボトルネックなし。

**層 0 のアノマリー比率**: 層 0 は全て safe effect → 0%（条件充足 ✓）

### P2 の層構造

| 層 | 質問タイプ | 記述素 | 役割 |
|----|-----------|--------|------|
| 0-P2 | 過去の体験探索（safe） | Fs-26, 24, 25, 38, 28, 61 | 探索 |
| 1-P2 | アノマリー質問 | safe + {Fs-27, 30, 35, 36} | 駆動 |

**ゲート辺**（P1 領域 → P2 新規領域）:

| src | tgt | w | 種別 | 根拠 |
|-----|-----|---|------|------|
| Fs-12 | Fs-26 | 0.8 | Gate (Rule 5) | 思い入れ→過去に飲んだことがある |

この辺により、P1→P2 シフト後に Consistent(O, P2) の Fs-12 から R(P2) 経由で Fs-26 に到達し、P2 の探索が開始される。

### P3 の層構造

| 層 | 質問タイプ | 記述素 | 役割 |
|----|-----------|--------|------|
| 0-P3 | 嘘の構造探索（safe） | Ft-22, 23, 37, D-01〜D-03, D-05, D-06 | 探索 |
| 1-P3 | アノマリー質問 | safe + {D-04, Ft-50} | 駆動 |

P2→P3 シフト後、Fs-27(Consistent) → Ft-23 → Ft-22 → Ft-37 の R(P3) 経路で嘘フレームワークに到達。追加のゲート辺は不要（既存の R(P3) で十分）。

### P4 の層構造

| 層 | 質問タイプ | 記述素 | 役割 |
|----|-----------|--------|------|
| 0-P4 | 遭難・極限状況の探索（safe） | Pt-1〜Pt-10, Ft-01〜Ft-33, D-07, D-11, D-14, D-15 | 探索 |
| 1-P4 | アノマリー質問 | safe + {Ft-34} | 駆動 |

**ゲート辺**（P3 領域 → P4 新規領域）:

| src | tgt | w | 種別 | 根拠 |
|-----|-----|---|------|------|
| Ft-50 | Pt-1 | 0.8 | Gate (Rule 5) | 危機的状況→遭難 |
| D-04 | D-07 | 0.8 | Gate (Rule 5) | 守るための嘘→極限状態で入手困難な食材 |

**R(P4) への追加辺**（横辺不足の補完）:

| src | tgt | w | 種別 | 根拠 |
|-----|-----|---|------|------|
| Pt-1 | Pt-2 | 0.9 | Rule 1 | 遭難→食料不足 |
| Pt-2 | Pt-3 | 0.8 | Rule 1 | 食料不足→仲間の死 |
| Pt-3 | Pt-4 | 0.8 | Rule 1 | 仲間の死→スープを飲ませた |
| Pt-4 | Pt-5 | 0.9 | Rule 1 | 飲ませた→ウミガメと言った |
| Ft-25 | Pt-7 | 0.7 | Rule 1 | 生き延びた→レストランで本物を飲んだ |
| Pt-7 | Pt-8 | 0.9 | Rule 1 | 本物→味の違いに気づいた |
| Pt-8 | Pt-9 | 0.9 | Rule 1 | 気づいた→正体を悟った |
| Pt-9 | Pt-10 | 0.9 | Rule 1 | 悟った→絶望して自殺 |

### P5 = T の層構造

P5 = T はアノマリーなし。P4→P5 シフト後の確認フェーズ。

**ゲート辺**（P4 領域 → P5 最終領域）:

| src | tgt | w | 種別 | 根拠 |
|-----|-----|---|------|------|
| Ft-34 | Pt-6 | 0.8 | Gate (Rule 5) | 社会的タブー→死んだ仲間の肉 |
| Ft-28 | Ft-29 | 0.8 | Gate (Rule 5) | 通常食べないもの→人肉 |

この辺により、P4→P5 シフト後に Ft-34(Consistent in P5) から Pt-6 に到達し、人肉の真実が展開される。

### S1 の層構造

| 層 | 質問タイプ | 記述素 |
|----|-----------|--------|
| 0-S1 | 専門家仮説の検証 | B-01(anomaly), Fs-24(safe) |

単層構造。最初の質問で即座にアノマリー。

### S2 の層構造

| 層 | 質問タイプ | 記述素 |
|----|-----------|--------|
| 0-S2 | 恐怖仮説の検証 | B-02(anomaly), Fs-28(safe) |

単層構造。最初の質問で即座にアノマリー。

---

## ゲート辺の総括

Phase 2 で設計されたゲート辺（R(P) への追加）:

### ゲート辺（Rule 5）

| パラダイム | src | tgt | w | 機能 |
|-----------|-----|-----|---|------|
| P2 | Fs-12 | Fs-26 | 0.8 | P1→P2 シフト後の P2 探索起点 |
| P4 | Ft-50 | Pt-1 | 0.8 | P3→P4 シフト後の P4 探索起点 |
| P4 | D-04 | D-07 | 0.8 | 嘘の動機→極限食材 |
| P5 | Ft-34 | Pt-6 | 0.8 | タブー→人肉の事実 |
| P5 | Ft-28 | Ft-29 | 0.8 | 通常食べない→人肉 |

### R(P) 横辺の追加（Rule 1）

| パラダイム | src | tgt | w | 根拠 |
|-----------|-----|-----|---|------|
| P4 | Pt-1 | Pt-2 | 0.9 | 遭難→食料不足 |
| P4 | Pt-2 | Pt-3 | 0.8 | 食料不足→仲間の死 |
| P4 | Pt-3 | Pt-4 | 0.8 | 仲間の死→スープを飲ませた |
| P4 | Pt-4 | Pt-5 | 0.9 | 飲ませた→ウミガメと言った |
| P4 | Ft-25 | Pt-7 | 0.7 | 生き延びた→レストランで飲んだ |
| P4 | Pt-7 | Pt-8 | 0.9 | 本物→味の違い |
| P4 | Pt-8 | Pt-9 | 0.9 | 気づいた→悟った |
| P4 | Pt-9 | Pt-10 | 0.9 | 悟った→自殺 |

これらの辺は P5 にも継承される。

---

## Step 4: 素材不足の検出

### 中間記述素の不足

Phase 1 の記述素空間（153 個）は十分。逆算で必要とされる中間ステップの記述素は全て F' に存在する。

**不足なし** ✓

### ゲート辺の不足

Phase 1（04_内部構造構成）で構成した R(P) にはゲート辺が未設定であった（横辺のみ）。上記「ゲート辺の総括」で 5 本のゲート辺を設計した。これらを R(P) に追加する必要がある。

また、P4 の Pt 間の因果連鎖（8 本の Rule 1 辺）が不足していた。追加が必要。

### 経路の冗長性

| パラダイム | アノマリーへの独立経路数 | 評価 |
|-----------|----------------------|------|
| P1 | 注文動機グループ（Fs-14 経由）、味覚反応グループ（Fs-17/21 経由）: 2 経路 | 十分 |
| P2 | Fs-26 → Aq2-1, Fs-38/34 → Aq2-2〜4: 2 経路 | 十分 |
| P3 | D-03 → Aq3-1, Fs-61 → Aq3-2: 2 経路 | 十分 |
| P4 | D-07 → Ft-28 → Aq4-1: 1 経路 | **要注意**（単一経路） |

**P4 の単一経路リスク**: Ft-34 へのアノマリー到達が D-07 → Ft-28 の単一経路に依存。Phase 3 で Ft-28 への代替到達（例: Ft-37 → Ft-28 辺の追加）を検討する。

---

## 全体の層構造サマリ

```
パラダイム    層0（safe探索）     層1（アノマリー導入）  層2
─────────────────────────────────────────────────────────
P1           基本事実 ~15問       注文動機 4問          過去 1問
             否定仮説 ~8問        味覚反応 3問
─────────────────────────────────────────────────────────
P2           過去体験探索 ~5問    4問（運命系）
─────────────────────────────────────────────────────────
P3           嘘の構造 ~7問       2問（動機・状況）
─────────────────────────────────────────────────────────
P4           遭難詳細 ~15問      1問（タブー）
─────────────────────────────────────────────────────────
P5           人肉の真実確認 ~5問  （アノマリーなし）
─────────────────────────────────────────────────────────
S1           専門家検証 1問       （即座にアノマリー）
S2           恐怖検証 1問         （即座にアノマリー）
```

**質問総数の見積もり**: 60〜70 問程度。Phase 3 で具体化。

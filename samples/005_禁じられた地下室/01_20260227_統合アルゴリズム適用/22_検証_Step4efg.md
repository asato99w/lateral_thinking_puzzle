# 検証 Step 4e/4f/4g: 到達パス検証・構造的品質診断・不足ルーティング

使用規則: 不足ルーティング → Step 1〜3

## Step 4e: 到達パス検証

### 方針

到達パス P1→P2→P3→P4→P5(T) の各遷移について、質問群の prerequisites チェーンが機能し、各パラダイムから次のパラダイムへ遷移するために必要な質問が到達可能であることを検証する。

### prerequisites チェーンの検証

Step 2（16_質問生成_Step2.md）で設計した prerequisites 構造を確認する。

```
層0（10問）: prerequisites なし → 即座に回答可能
  ↓ Fs-54:0(q-01), Fs-39:0(q-02), etc.
層1（6問）: {Fs-54:0} or {Fs-39:0}
  ↓ Fs-87:0(q-11), Fs-86:1(q-15), Fs-35:1(q-14), etc.
層2（5問）: {Fs-87:0, Fs-86:1} or {Fs-88:0, Fs-100:1} or {Fs-35:1}
  ↓ M-4:1(q-20), Ft-20:1(q-19), Fs-88:0(q-18), etc.
層3（5問）: {M-4:1, Fs-14:0} or {M-1:1, M-4:1} or {Pt-1:1}
  ↓ Pt-1:1(q-23), M-1:1(q-22), etc.
層4（3問）: {Pt-1:1, Ft-20:1} or {Fs-51:0} or {Pt-1:1, M-5:1}
```

### 各遷移の到達可能性

| 遷移 | 必要な flip 質問 | flip 質問の層 | 到達パス | 状態 |
|---|---|---|---|---|
| P1→P2 | q-03(Fs-34:0), q-14(Fs-35:1) | 層0, 層1 | 層0→層1 の prerequisites チェーンで到達可能 | ✓ |
| P2→P3 | q-01(Fs-54:0), q-04(Fs-67:0), q-11(Fs-87:0), q-16(Fs-89:0), q-19(Ft-20:1) | 層0,0,1,1,2 | 層0→層1→層2 の prerequisites チェーンで到達可能 | ✓ |
| P3→P4 | q-18(Fs-88:0), q-20(M-4:1,Ft-22:1) | 層2,2 | 層0→層1→層2 で到達可能 | ✓ |
| P4→P5 | q-27(Fs-51:0) | 層4 | 層0→層1→層2→層3→層4 で到達可能 | ✓ |

### Step 4e 判定

全遷移の flip 質問が prerequisites チェーンを通じて到達可能である。

**Step 4e: ✓（条件付き — 動的シミュレーションは形式化後に実施）**

> 注記: 完全な到達パス検証（resolve の定量的検証、シフト発動条件の逐次確認）は POC エンジンでのシミュレーションを要する。ここでは prerequisites の構造的充足を確認した。

## Step 4f: 構造的品質診断

### 前提閉包性

各質問の prerequisites が、先行質問の effect を通じて O に供給されることを確認する。

16_質問生成_Step2.md の「prerequisites の充足可能性確認」で全 prerequisites が先行質問の effect で充足可能であること、循環依存がないことを確認済み。

**前提閉包性: ✓**

### 層間連鎖性

各層の質問が次の層への prerequisites を供給する連鎖が途切れていないことを確認する。

| 供給元層 | 供給される記述素 | 消費先層 | 連鎖 |
|---|---|---|---|
| 層0 | Fs-54:0, Fs-39:0, Fs-14:0 | 層1 | ✓ |
| 層1 | Fs-87:0, Fs-86:1, Fs-35:1 | 層2 | ✓ |
| 層2 | Fs-88:0, Fs-100:1, Ft-20:1, M-4:1 | 層3 | ✓ |
| 層3 | Pt-1:1, M-1:1, M-5:1 | 層4 | ✓ |

**層間連鎖性: ✓**

### Step 4f 判定

**Step 4f: ✓**

## Step 4g: 不足ルーティング

### 検証結果の集約

| Step | 結果 | 不足の詳細 |
|---|---|---|
| 4a（完全性） | **NG** | Fs-40 が未カバー |
| 4c（多層構造） | 条件付き合格 | P1/P2 の ratio 超過（構造的）、P4 の layers 不足（構造的） |
| 4d（シフト方向） | 条件付き合格 | P1→P2 の S1/S2 不充足（構造的・neighbors で緩和）、P2→P3 の S2 不充足（構造的） |
| 4e（到達パス） | ✓ | — |
| 4f（構造的品質） | ✓ | — |

### 差し戻しの決定

**唯一のアクション対象: Fs-40 の完全性不足（Step 4a）**

| 不足 | 種類 | 差し戻し先 | 対処内容 |
|---|---|---|---|
| Fs-40 未カバー | 質問不足（effect の不足） | **Phase 3** | q-02 の ans_no effect を拡張 |

Step 4c, 4d の不充足は構造的特性に起因し、設計の見直しでは解消できない。差し戻しの対象外とする。

### 差し戻しの実行計画

**Phase 3 差し戻し**: q-02 の ans_no effect を修正

- **現在**: q-02 ans_no = {Fs-39:0, Fs-27:0}
- **修正後**: q-02 ans_no = {Fs-39:0, Fs-27:0, **Fs-40:0**}

**意味的妥当性**: q-02 は「ドアの向こうに危険なもの（爆発物や毒物など）があるから禁止されていましたか？」という質問。「いいえ」の回答は危険物禁止の仮説を否定する。Fs-40（犯罪の証拠があるため禁止された）は Fs-39（危険物禁止）の含意グループに属し（15_質問生成_Step1.md の含意グルーピング参照）、q-02 の否定は犯罪証拠による禁止の仮説も否定する。

**影響範囲の確認**:

1. q-02 の ans_yes effect には変更なし（{Fs-39:1, Fs-27:1} のまま）
2. Fs-40 は P1=1, P2=1, P3=不定, P4=不定, P5(T)=0
3. q-02 ans_no に Fs-40:0 を追加しても、既存の検証結果に影響しない:
   - Step 4c: q-02 の anomaly_count が P1, P2 で +1 増加するが、既に層0 のアノマリー質問であるため比率は変わらない
   - Step 4d: P1→P2 では Fs-40:0 vs P2(Fs-40)=1 → oppose +1。P2→P3 では Fs-40:0 vs P3=不定 → 変化なし。既存の分析結果の傾向に影響しない
   - Step 4e: prerequisites に影響なし

**差し戻しにより修正が必要なファイル**: 新規ファイル（23_質問修正_Fs40.md）を追加する。既存ファイルは変更しない（オープンクローズド原則）。

### 収束判定

Fs-40 の修正後、Step 4a の再検証で RequiredAnomaly(P2) の Fs-40 がカバーされることを確認すれば、Phase 4 の検証は完了する。Step 4e の到達パス検証が通過しているため、収束条件を満たす。

**次のアクション: 23_質問修正_Fs40.md の作成 → Step 4a の再検証 → 形式化へ進む**

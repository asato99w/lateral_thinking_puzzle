# Phase 1 差し戻し: R(P) 強化

使用規則: 関係構造の構成 Rule 1〜5

## 差し戻し根拠

09_検証結果診断により、R(P) の関係が疎すぎてゲート開放率が 8〜11% に留まることが主因と判明。
エンジンの `open_questions` は BFS 到達性チェック（条件3）を行うため、R(P) のゲート辺（Rule 5）と横辺（Rule 1〜3）の充実が必要。

## 構造的問題の追加発見

### 問題1: neighbors 未定義

形式化に neighbors（近傍パラダイム）が含まれていない。エンジンの `select_shift_target` は `pid not in p_current.neighbors` でフィルタするため、neighbors が空だとシフトが一切発生しない。

03_パラダイム発見のパス構造に基づく neighbors 定義:

| パラダイム | neighbors | 根拠 |
|-----------|-----------|------|
| P1 | [P2, S1] | メインパス次 + サブパス分岐 |
| P2 | [P3, S2] | メインパス次 + サブパス分岐 |
| P3 | [P4] | メインパス次（S1 合流先） |
| P4 | [P5] | メインパス次（S2 合流先） |
| P5 | [] | 最終パラダイム |
| S1 | [P3] | 合流先 |
| S2 | [P4] | 合流先 |

### 問題2: P3・P4 のアノマリー不在

P3・P4 は T に近い予測を持つため、層0質問の回答後に anomaly 集合が空になる。エンジンの anomaly_reach ベース開放が機能しない。

対処: P3・P4 の p_pred に、S の額面解釈に基づく予測を追加し、層0で自然なアノマリーを生成する。

## P1: R(P1) の強化

### 現状分析

現在の R(P1): 7本（全て Fs-31 起点）
層0回答後の anomaly: {Fs-1, Fs-19, Fs-31, M-3}
層0回答後の consistent: {Fs-14, Fs-96, Fs-23}
現在の anomaly_reach: Fs-31 経由で {Fs-71, Fs-34, Ps-1, Ps-5, Ps-6, Fs-83} のみ
層1ゲート開放率: 1/9（11%）

### 追加するゲート辺（Rule 5）

| from | to | weight | 意味（P1 内の推論） | 開放対象 |
|------|----|--------|-------------------|---------|
| Fs-31 | Fs-60 | 0.7 | 禁止に足る何か → 死体仮説（P1 の具体化方向） | q08 |
| Fs-31 | Fs-61 | 0.7 | 禁止に足る何か → 違法物仮説 | q09 |
| Fs-31 | M-4 | 0.7 | 禁止物が不在（anomaly）→ 禁止者の虚偽を疑う | q11 |
| Fs-19 | M-1 | 0.7 | 好奇心ではない（anomaly）→ 自由の制限を疑う | q13 |

### 追加する横辺（Rule 1〜3）

| from | to | weight | 意味 |
|------|----|--------|------|
| Fs-23 | Fs-24 | 0.7 | 誰かが禁止した → 禁止には理由がある |
| Fs-14 | Fs-3 | 0.6 | 住人 → ドアの存在を知っていた |
| Fs-71 | Fs-75 | 0.8 | 犯罪と判断 → 犯罪現場として通報 |

### 強化後の R(P1)（全14本）

既存:
1. Fs-31 → Fs-71（0.8）
2. Fs-31 → Fs-34（0.7）
3. Fs-19 → Ps-1（0.6）
4. Fs-71 → Ps-5（0.8）
5. Fs-31 → Ps-6（0.8）
6. Fs-31 → Fs-83（0.7）
7. Fs-31 → M-3（0.8）

追加（ゲート辺）:
8. Fs-31 → Fs-60（0.7）
9. Fs-31 → Fs-61（0.7）
10. Fs-31 → M-4（0.7）
11. Fs-19 → M-1（0.7）

追加（横辺）:
12. Fs-23 → Fs-24（0.7）
13. Fs-14 → Fs-3（0.6）
14. Fs-71 → Fs-75（0.8）

### 強化後のゲート開放率推定

anomaly_reach の拡大: Fs-31 から {Fs-60, Fs-61, M-4} に到達可能。Fs-19 から {M-1} に到達可能。

| 層1質問 | effect | 開放判定 |
|---------|--------|---------|
| q08 | Fs-60=0 | Fs-60 ∈ anomaly_reach → **開放** |
| q09 | Fs-61=0, Fs-40=0 | Fs-61 ∈ anomaly_reach → **開放** |
| q11 | M-4=1, Ft-22=1 | M-4 ∈ anomaly_reach → **開放** |
| q13 | M-1=1, Ft-32=1 | M-1 ∈ anomaly_reach → **開放** |
| q14 | Fs-96=1, Ft-17=1 | Fs-96 ∈ consistent_reach, pred=1, v=1 → **開放** |

ゲート開放率: 5/5 質問開放（effect 記述素ベースでも大幅改善）

---

## P2: R(P2) の強化

### 現状分析

現在の R(P2): 7本（Fs-31 起点 + Fs-87 起点）
層0回答後の anomaly: {Fs-1, Fs-19, Fs-31, M-3}（P1 と同じ — P2 も Fs-31=1 と予測）
層0回答後の consistent: {Fs-14, Fs-96, Fs-23}
層1ゲート開放率: 1/10（10%）

### 追加するゲート辺（Rule 5）

| from | to | weight | 意味（P2 内の推論） | 開放対象 |
|------|----|--------|-------------------|---------|
| Fs-31 | Fs-60 | 0.7 | 禁止物（一時存在仮説）→ 死体仮説の具体化 | q08 |
| Fs-31 | Fs-61 | 0.7 | 禁止物 → 違法物仮説 | q09 |
| Fs-31 | M-4 | 0.7 | 禁止物不在の anomaly → 虚偽の疑い | q11 |
| Fs-19 | M-1 | 0.7 | 好奇心否定 → 自由の制限 | q13 |
| Fs-87 | Fs-87 | — | （q21 は init に追加で対応。Phase 3） | — |

### 追加する横辺（Rule 1〜3）

| from | to | weight | 意味 |
|------|----|--------|------|
| Fs-82 | Fs-87 | 0.7 | 確認タイミングのずれ → 事後撤去仮説（P2 固有） |
| Fs-71 | Fs-75 | 0.8 | 犯罪と判断 → 犯罪現場として通報 |

### 強化後の R(P2)（全13本）

既存:
1. Fs-31 → Fs-71（0.8）
2. Fs-31 → Fs-34（0.7）
3. Fs-19 → Ps-1（0.6）
4. Fs-71 → Ps-5（0.8）
5. Fs-87 → Ps-6（0.8）
6. Fs-87 → Fs-82（0.7）
7. Fs-87 → Fs-83（0.7）

追加（ゲート辺）:
8. Fs-31 → Fs-60（0.7）
9. Fs-31 → Fs-61（0.7）
10. Fs-31 → M-4（0.7）
11. Fs-19 → M-1（0.7）

追加（横辺）:
12. Fs-82 → Fs-87（0.7）
13. Fs-71 → Fs-75（0.8）

---

## P3: R(P3) の強化

### 現状分析

現在の R(P3): 5本（Fs-83 起点が中心）
層0回答後の anomaly: **空**（P3 の予測は T に近く、層0効果と矛盾しない）
層0回答後の consistent: {Ps-1..6, Fs-31, Fs-60}（Fs-31=0 pred=0, Fs-60=0 pred=0）
層1ゲート開放率: 1/13（8%）— 唯一 q08 が Fs-60 の consistent 経由で開放

### 問題: anomaly 集合が空

P3 は Fs-31=0, Fs-60..63=0, Fs-87=0 を全て正しく予測するため、層0回答で anomaly が発生しない。anomaly_reach が空のため、p_pred 外の記述素（M-4, M-1 等）を effect に持つ質問は開放不可能。

### 対処: p_pred 追加によるアノマリー生成

P3「女性の主観と客観が異なる」は、S の記述を客観的事実として受け取る段階の解釈である（04_内部構造構成 Step 1 参照）。従って以下の予測は P3 の解釈として自然:

| descriptor_id | 追加 value | 根拠 |
|---------------|-----------|------|
| Fs-96 | 0 | P3 は S を額面通りに読む。「地下室」は文字通りの地下室。 |
| Fs-14 | 1 | P3 は女性が建物の住人であると仮定。 |

層0で q02(no) → Fs-96=1 が O に入り、P3 pred Fs-96=0 → **anomaly** 発生。
Fs-14=1 → P3 pred=1 → consistent（anomaly にはならないが p_pred 拡充）。

### 追加するゲート辺（Rule 5）

| from | to | weight | 意味（P3 内の推論） | 開放対象 |
|------|----|--------|-------------------|---------|
| Fs-31 | Fs-83 | 0.8 | 禁止物なし → 驚きの原因は非物理的（P3 コア推論の起点） | q24 等 |
| Fs-60 | Fs-61 | 0.7 | 死体なし → 違法物もなし（pred=0 の否定クラスタ連鎖） | q09 |
| Fs-60 | Fs-62 | 0.7 | 死体なし → 装置もなし | — |
| Fs-96 | Fs-100 | 0.7 | 隠し空間（anomaly）→ 主客乖離の認識 | q24 |
| Fs-84 | M-4 | 0.6 | 主客のずれ → 欺瞞者の存在を疑う | q11 |
| Fs-84 | Ft-20 | 0.7 | 主客のずれ → S の記述が主観的ではないかと疑う | q27 |

### 追加する横辺（Rule 1〜3）

| from | to | weight | 意味 |
|------|----|--------|------|
| Fs-83 | Fs-56 | 0.7 | 非物理的原因 → 期待と現実のギャップ |
| Fs-84 | D-4 | 0.7 | 主客のずれ → 異常の基準が主観的 |
| Fs-56 | Fs-98 | 0.7 | ギャップ経験 → 認識と現実のギャップ |

### 強化後の R(P3)（全14本）

既存:
1. Fs-83 → Fs-84（0.8）
2. Fs-84 → Fs-86（0.7）
3. Fs-56 → Ps-4（0.7）
4. Fs-83 → Fs-31（0.8）
5. Fs-83 → Fs-87（0.7）

追加（ゲート辺）:
6. Fs-31 → Fs-83（0.8）
7. Fs-60 → Fs-61（0.7）
8. Fs-60 → Fs-62（0.7）
9. Fs-96 → Fs-100（0.7）
10. Fs-84 → M-4（0.6）
11. Fs-84 → Ft-20（0.7）

追加（横辺）:
12. Fs-83 → Fs-56（0.7）
13. Fs-84 → D-4（0.7）
14. Fs-56 → Fs-98（0.7）

### 強化後のゲート開放推定

consistent_reach: Fs-31→Fs-83→{Fs-84, Fs-87, Fs-31}→Fs-84→{Fs-86, M-4, Ft-20, D-4}、Fs-60→{Fs-61, Fs-62}
anomaly_reach（Fs-96 起点）: Fs-96→Fs-100

| 層1質問 | 主要 effect | 開放判定 |
|---------|-----------|---------|
| q08 | Fs-60=0 | consistent（既存） → **開放** |
| q09 | Fs-61=0 | Fs-61 ∈ consistent_reach, pred=0, v=0 → **開放** |
| q11 | M-4=1 | M-4 ∈ consistent_reach（Fs-84 経由）だが pred=None → 不開放。anomaly_reach にも不在。→ **P3 単独では不開放**（P4 シフト後に開放） |
| q13 | M-1=1 | 同上。→ **P3 単独では不開放** |
| q14 | Fs-96=1 | Fs-96 ∈ anomaly（pred=0, v=1）→ anomaly_reach。Ft-17 は anomaly_reach? → **開放** |
| q24 | Fs-84=1 | Fs-84 ∈ consistent_reach, pred=1, v=1 → **開放** |

ゲート開放率: 4/6 質問開放。q11, q13 は P3 で開かなくても P4 シフト後に開放可能。

---

## P4: R(P4) の強化

### 現状分析

現在の R(P4): 11本（M-4 と D 系記述素の連鎖が主体）
層0回答後の anomaly: **空**（P4 も T に近い予測で、層0効果との矛盾なし）
層0回答後の consistent: {Ps-1..6, Fs-19, Fs-31, Fs-60}

### 対処: p_pred 追加によるアノマリー生成

P4「女性は嘘をつかれていた」は、嘘の存在を認識するが、「地下室」が文字通りの地下室かどうかは不定〜額面通り方向。

| descriptor_id | 追加 value | 根拠 |
|---------------|-----------|------|
| Fs-96 | 0 | P4 はまだ「地下室」を額面通りに扱う傾向（Ft-16 不定） |
| Fs-14 | 0 | P4 は女性が騙されていたため住人ではないと推測 |

層0で q02(no) → Fs-96=1 → P4 pred=0 → anomaly。
層0で q01(yes) → Fs-14=1 → P4 pred=0 → anomaly。

### 追加するゲート辺（Rule 5）

| from | to | weight | 意味（P4 内の推論） | 開放対象 |
|------|----|--------|-------------------|---------|
| Fs-31 | Fs-83 | 0.8 | 禁止物なし → 原因は非物理的 | q24 |
| Fs-60 | Fs-61 | 0.7 | 死体なし → 違法物もなし | q09 |
| Fs-14 | M-4 | 0.7 | 住人でない（anomaly）→ 欺瞞の存在 | q11 |
| Fs-14 | M-1 | 0.7 | 住人でない（anomaly）→ 自由の制限 | q13 |
| Fs-96 | D-1 | 0.7 | 隠し空間（anomaly）→ ドアの意味を知らなかった | q39 |

### 追加する横辺（Rule 1〜3）

| from | to | weight | 意味 |
|------|----|--------|------|
| Fs-83 | Fs-84 | 0.8 | 非物理的原因 → 主客のずれ（P3 から継承） |
| D-3 | D-6 | 0.7 | 操作された世界観 → S 全体が主観ずれ |

### 強化後の R(P4)（全18本）

既存:
1. Fs-83 → Fs-84（0.8）
2. Fs-84 → Fs-86（0.7）
3. Fs-56 → Ps-4（0.7）
4. Fs-83 → Fs-31（0.8）
5. Fs-83 → Fs-87（0.7）
6. M-4 → D-3（0.8）
7. M-4 → D-7（0.8）
8. D-3 → Fs-84（0.8）
9. D-7 → B-6（0.7）
10. M-4 → Fs-34（0.8）
11. D-3 → Fs-88（0.8）

追加（ゲート辺）:
12. Fs-31 → Fs-83（0.8）
13. Fs-60 → Fs-61（0.7）
14. Fs-14 → M-4（0.7）
15. Fs-14 → M-1（0.7）
16. Fs-96 → D-1（0.7）

追加（横辺）:
17. Fs-83 → Fs-84（0.8）← 既存1と同一のため省略
17. D-3 → D-6（0.7）

（実質追加 6本、合計 17本）

---

## P5（T）: R(P5) の強化

### 現状分析

現在の R(P5): 15本（Pt 起点の充実した構造）
層0回答後の anomaly: {Fs-14}（Fs-14=1, P5 pred=0）
層0回答後の consistent: {Fs-19, Fs-31, Fs-60, M-1, Ft-1} 等多数

### P5 の特殊性

P5 は T であり、ほぼ全ての予測が真値と一致する。anomaly は Fs-14（q01 の回答、住人か否かの解釈差）のみ。多層構造検証（L2-4）は anomaly 質問の分布を見るが、P5 の anomaly は Fs-14 の 1 件のみ（層0）で ratio=1.00。

### 対処方針

P5 は最終パラダイムであり、ゲート開放率の問題は小さい（P5 到達時には O が充実しており、大半の質問が開放済み）。L2-4 の層0比率問題は、q01 の correct_answer の見直し（Phase 3）で対応する。

R(P5) への追加は最小限:

| from | to | weight | 意味 |
|------|----|--------|------|
| Fs-14 | Ft-17 | 0.7 | 住人でない（anomaly）→ 監禁部屋にいる |
| D-3 | Ft-22 | 0.8 | 操作された世界観 → 虚偽の世界観植え付け |

強化後の R(P5): 17本

---

## S1: R(S1) の強化

### 現状分析

現在の R(S1): 5本
層0回答後の anomaly: {Fs-19, Fs-31, M-3}（P1 と類似だが Fs-71=0 も pred 差あり）
層0回答後の consistent: {Fs-96, Fs-23}

### 追加するゲート辺

| from | to | weight | 意味（S1: 女性が犯罪に加担） | 開放対象 |
|------|----|--------|--------------------------|---------|
| Fs-31 | Fs-60 | 0.7 | 禁止物 → 死体仮説 | q08 |
| Fs-31 | Fs-61 | 0.7 | 禁止物 → 違法物 | q09 |
| Fs-35 | M-4 | 0.7 | 秘密を守る → 虚偽の疑い | q11 |
| Fs-19 | M-1 | 0.7 | 好奇心否定 → 自由制限 | q13 |

### 追加する横辺

| from | to | weight | 意味 |
|------|----|--------|------|
| Fs-31 → Fs-35 | — | — | （既存） |
| Fs-35 | Fs-44 | 0.6 | 秘密を守る → 強い禁止の示唆 |

### 強化後の R(S1): 11本

---

## S2: R(S2) の強化

### 現状分析

現在の R(S2): 5本
層0回答後の anomaly: {Fs-1, Fs-19, Fs-31, M-3}
層0回答後の consistent: {Fs-14, Fs-96, Fs-23}

### 追加するゲート辺

| from | to | weight | 意味（S2: 建物に秘密がある） | 開放対象 |
|------|----|--------|--------------------------|---------|
| Fs-31 | Fs-60 | 0.7 | 禁止物 → 死体仮説 | q08 |
| Fs-31 | Fs-61 | 0.7 | 禁止物 → 違法物 | q09 |
| B-1 | M-4 | 0.7 | 場所が定義されたもの → 欺瞞を疑う | q11 |
| Fs-19 | M-1 | 0.7 | 好奇心否定 → 自由制限 | q13 |

### 追加する横辺

| from | to | weight | 意味 |
|------|----|--------|------|
| Fs-96 → B-1 | — | — | （既存） |
| B-1 | Fs-84 | 0.6 | 場所の認識が定義された → 主客のずれ |

### 強化後の R(S2): 11本

---

## 変更サマリ

### R(P) 追加辺数

| パラダイム | 既存 | 追加 | 合計 |
|-----------|------|------|------|
| P1 | 7 | 7 | 14 |
| P2 | 7 | 6 | 13 |
| P3 | 5 | 9 | 14 |
| P4 | 11 | 6 | 17 |
| P5 | 15 | 2 | 17 |
| S1 | 5 | 5 | 10 |
| S2 | 5 | 5 | 10 |

### p_pred 追加

| パラダイム | 追加記述素 | value | 根拠 |
|-----------|----------|-------|------|
| P3 | Fs-96 | 0 | S を額面通りに読む |
| P3 | Fs-14 | 1 | 住人と仮定 |
| P4 | Fs-96 | 0 | 地下室を額面通りに扱う |
| P4 | Fs-14 | 0 | 騙されていたため住人でない |

### neighbors 追加

全パラダイムに neighbors を定義（上記表参照）。

### 残存課題（Phase 3 で対処）

1. init_question_ids に q21, q23, q24 を追加
2. q24, q27 のパラダイムリストに P1, S1 を追加（完全性ギャップ解消）
3. q01 の correct_answer 見直し（P5 anomaly 問題）
4. q10, q35（irrelevant）の init_question_ids 追加（エンジン仕様への対応）

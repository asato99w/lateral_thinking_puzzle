# 補充検証：S1 適用

入力:
- 形式化（06_形式化.md）に基づく JSON データ（app/poc/data/desert_man.json）
- opening_reach.py, anomaly_discovery.py の検証結果

## 検証結果

### 静的検証（opening_reach）

**NG** — 全メインパスパラダイム（P1, P2, P3）が不合格。

| パラダイム | 固有想起記述素 | R(P)到達可能 | anomaly上界 | threshold | 結果 |
|-----------|-------------|------------|-----------|-----------|------|
| P1 | 2 | 7 | 1 | 5 | NG |
| P2 | 0 | 0 | 0 | 2 | NG |
| P3 | 0 | 0 | 0 | 1 | NG |

**原因**: 砂漠の男の記述素空間は、パラダイム間で Conceivable の重複が大きく、固有想起記述素（他のどのパラダイムの Conceivable にも含まれない記述素）がほぼ存在しない。P2, P3 は固有想起記述素が 0 であり、構造的に R(P) による到達が不可能。

これは R(P) の設計上の構造的限界であり、動的検証で補完する。

### 動的検証（anomaly_discovery）

#### Part 1: 初期オープン汚染チェック

初期オープン質問 3 件（q04, q10, q11）のうち anomaly 質問は 0 件。**OK**。

#### Part 2: 発掘連鎖シミュレーション（修正前）

全 46 質問中 anomaly 質問 17 件。初期状態で **0/17 が発掘不可**。

発掘不可: q01, q02, q03, q05, q06, q07, q08, q09, q15, q16, q17, q18, q20, q40, q41, q42, q44

## 不足診断

### 共通原因

17 件すべてが **類型 D**（発掘連鎖の断絶）。

**根本原因**: 初期同化で H が EPSILON 圏内に到達する記述素が Fs-11（H=0.95）と Fs-13（H=1.0, 観測済）のみ。P1 の R(P) は Fs-13 → Fs-11 の 1 ホップしか到達せず、anomaly 質問の効果記述素はいずれも H=0.5 のまま。結果、|H(d)-v| = 0.5 > EPSILON(0.2) でオープン条件を満たせない。

さらに、safe 質問チェーン（q19-q39 等）も同様に H=0.5 で停滞するため、前提条件記述素の連鎖（Ft-02 → Ft-11 → Ft-13 → Ft-16）を経由する q44 にも到達できない。

### 修正方針

各質問の effect に「開放記述素」を追加し、偶然の開きの構造にする。

- **開放記述素**: 同化連鎖で H が正解値方向に動く記述素（質問のオープン条件を満たす）
- **anomaly 記述素**: 元の記述素（P_init の予測と矛盾する）

### 開放記述素の分類

| フェーズ | 開放記述素 | H 到達契機 | 対象質問 |
|---------|-----------|-----------|---------|
| P1 初期同化 | Fs-11=1 (H→0.95) | q04 回答（Fs-13=1 obs → Fs-13→Fs-11 同化） | q01-q03, q05-q09, q15-q18, q20, q40-q42（16件） |
| q15 回答後 | Fs-11=1 (H=1.0) | q15 回答で Fs-11=1 再観測 | q24（safe chain） |
| q24 回答後 | Ft-11=1 (H=1.0) | q24 回答（Ft-11=1 obs） | q25（safe chain） |
| q25 回答後 | Ft-13=1 (H=1.0) | q25 回答（Ft-13=1 obs） | q28（safe chain） |
| q28 回答後 | *(自動)* | q28 回答（Ft-16=1 obs）→ q44 の Ft-16=1 opener が機能 | q44 |

q44 は Ft-16 が P1/P2 の Conceivable 外であるため、P3 以降のパラダイムシフト後にのみオープン可能。Ft-16=1 が q44 の元 ans_yes に含まれており、q28 回答で Ft-16 が観測（H=1.0）されることで自動的にオープンする。追加修正不要。

## 対処：全 19 件の修正

### anomaly 質問の修正（16 件）

#### q01: Fs-11 開放 + D-03 anomaly

| 項目 | 修正前 | 修正後 |
|------|-------|-------|
| ans_yes | [(D-03, 0)] | [(D-03, 0), (Fs-11, 0)] |
| ans_no | [(D-03, 1)] | [(D-03, 1), (Fs-11, 1)] |

**開放記述素**: Fs-11「脱衣は意識的行為」(P1 D⁺, pred=1) — q04 回答後 H=0.95

#### q02: Fs-11 開放 + Fs-08 anomaly

| 項目 | 修正前 | 修正後 |
|------|-------|-------|
| ans_yes | [(Fs-08, 1)] | [(Fs-08, 1), (Fs-11, 0)] |
| ans_no | [(Fs-08, 0)] | [(Fs-08, 0), (Fs-11, 1)] |

#### q03: Fs-11 開放 + Ft-03 anomaly

| 項目 | 修正前 | 修正後 |
|------|-------|-------|
| ans_yes | [(Ft-03, 0)] | [(Ft-03, 0), (Fs-11, 0)] |
| ans_no | [(Ft-03, 1)] | [(Ft-03, 1), (Fs-11, 1)] |

#### q05: Fs-11 開放 + Fs-08 anomaly

| 項目 | 修正前 | 修正後 |
|------|-------|-------|
| ans_yes | [(Fs-08, 1)] | [(Fs-08, 1), (Fs-11, 0)] |
| ans_no | [(Fs-08, 0)] | [(Fs-08, 0), (Fs-11, 1)] |

#### q06: Fs-11 開放 + Fs-20 anomaly

| 項目 | 修正前 | 修正後 |
|------|-------|-------|
| ans_yes | [(Fs-20, 1)] | [(Fs-20, 1), (Fs-11, 0)] |
| ans_no | [(Fs-20, 0)] | [(Fs-20, 0), (Fs-11, 1)] |

#### q07: Fs-11 開放 + Fs-23 anomaly

| 項目 | 修正前 | 修正後 |
|------|-------|-------|
| ans_yes | [(Fs-23, 1)] | [(Fs-23, 1), (Fs-11, 1)] |
| ans_no | [(Fs-23, 0)] | [(Fs-23, 0), (Fs-11, 0)] |

#### q08: Fs-11 開放 + M-01 anomaly

| 項目 | 修正前 | 修正後 |
|------|-------|-------|
| ans_yes | [(M-01, 0)] | [(M-01, 0), (Fs-11, 0)] |
| ans_no | [(M-01, 1)] | [(M-01, 1), (Fs-11, 1)] |

#### q09: Fs-11 開放 + Fs-09 anomaly

| 項目 | 修正前 | 修正後 |
|------|-------|-------|
| ans_yes | [(Fs-09, 1)] | [(Fs-09, 1), (Fs-11, 1)] |
| ans_no | [(Fs-09, 0)] | [(Fs-09, 0), (Fs-11, 0)] |

#### q15: Fs-11 開放 + Ft-02 anomaly

| 項目 | 修正前 | 修正後 |
|------|-------|-------|
| ans_yes | [(Ft-02, 1)] | [(Ft-02, 1), (Fs-11, 1)] |
| ans_no | [(Ft-02, 0)] | [(Ft-02, 0), (Fs-11, 0)] |

#### q16: Fs-11 開放 + Ft-01 anomaly

| 項目 | 修正前 | 修正後 |
|------|-------|-------|
| ans_yes | [(Ft-01, 1)] | [(Ft-01, 1), (Fs-11, 1)] |
| ans_no | [(Ft-01, 0)] | [(Ft-01, 0), (Fs-11, 0)] |

#### q17: Fs-11 開放 + Ft-27 anomaly

| 項目 | 修正前 | 修正後 |
|------|-------|-------|
| ans_yes | [(Ft-27, 1)] | [(Ft-27, 1), (Fs-11, 1)] |
| ans_no | [(Ft-27, 0)] | [(Ft-27, 0), (Fs-11, 0)] |

#### q18: Fs-11 開放 + Ft-28 anomaly

| 項目 | 修正前 | 修正後 |
|------|-------|-------|
| ans_yes | [(Ft-28, 1)] | [(Ft-28, 1), (Fs-11, 1)] |
| ans_no | [(Ft-28, 0)] | [(Ft-28, 0), (Fs-11, 0)] |

#### q20: Fs-11 開放 + Ft-03 anomaly（前提: Ft-02）

| 項目 | 修正前 | 修正後 |
|------|-------|-------|
| ans_yes | [(Ft-03, 1)] | [(Ft-03, 1), (Fs-11, 1)] |
| ans_no | [(Ft-03, 0)] | [(Ft-03, 0), (Fs-11, 0)] |

**備考**: 前提条件 Ft-02 は q15 回答で充足。Fs-11 は q15 回答後 H=1.0（再観測）。

#### q40: Fs-11 開放 + D-02 anomaly（前提: Fs-20）

| 項目 | 修正前 | 修正後 |
|------|-------|-------|
| ans_yes | [(D-02, 1)] | [(D-02, 1), (Fs-11, 1)] |
| ans_no | [(D-02, 0)] | [(D-02, 0), (Fs-11, 0)] |

**備考**: 前提条件 Fs-20 は q06 回答で充足。

#### q41: Fs-11 追加開放（既存 opener Fs-01 は H=0.5 で不足）

| 項目 | 修正前 | 修正後 |
|------|-------|-------|
| ans_yes | [(Fs-01, 1), (B-01, 1)] | [(Fs-01, 1), (B-01, 1), (Fs-11, 1)] |
| ans_no | [(B-01, 0)] | [(B-01, 0), (Fs-11, 0)] |

**備考**: 既存の Fs-01=1 opener は H(Fs-01)=0.5 で EPSILON 圏外。Fs-11=1 を追加。

#### q42: Fs-11 追加開放（既存 opener Fs-17 は H=0.5 で不足）

| 項目 | 修正前 | 修正後 |
|------|-------|-------|
| ans_yes | [(Fs-17, 1), (Ft-02, 1)] | [(Fs-17, 1), (Ft-02, 1), (Fs-11, 1)] |
| ans_no | [(Ft-02, 0)] | [(Ft-02, 0), (Fs-11, 0)] |

### safe チェーン修正（3 件）

q44 の前提条件 Ft-16 到達のため、safe 質問チェーンにも開放記述素を追加。

#### q24: Fs-11 開放（safe, 前提: Ft-02）

| 項目 | 修正前 | 修正後 |
|------|-------|-------|
| ans_yes | [(Ft-11, 1)] | [(Ft-11, 1), (Fs-11, 1)] |
| ans_no | [(Ft-11, 0)] | [(Ft-11, 0), (Fs-11, 0)] |

**開放記述素**: Fs-11=1 (H=1.0, q15 で再観測済) — Ft-02 前提充足後にオープン

#### q25: Ft-11 開放（safe, 前提: Ft-11）

| 項目 | 修正前 | 修正後 |
|------|-------|-------|
| ans_yes | [(Ft-13, 1)] | [(Ft-13, 1), (Ft-11, 1)] |
| ans_no | [(Ft-13, 0)] | [(Ft-13, 0), (Ft-11, 0)] |

**開放記述素**: Ft-11=1 (H=1.0, q24 で観測) — P1 pred なし（safe 維持）、P4 Conceivable 内

#### q28: Ft-13 開放（safe, correct=no, 前提: Ft-13）

| 項目 | 修正前 | 修正後 |
|------|-------|-------|
| ans_yes | [(Ft-16, 0)] | [(Ft-16, 0), (Ft-13, 0)] |
| ans_no | [(Ft-16, 1)] | [(Ft-16, 1), (Ft-13, 1)] |

**開放記述素**: Ft-13=1 in ans_no (H=1.0, q25 で観測) — P1 pred なし（safe 維持）、P4 Conceivable 内

### q44 について

q44 は直接の修正不要。上記 safe チェーン修正により以下の経路で自動発掘:

```
q04 → Fs-13=1 obs → Fs-11 H=0.95
  → q15 opens (Fs-11=1) → Ft-02=1 obs
    → q24 opens (Fs-11=1) → Ft-11=1 obs
      → q25 opens (Ft-11=1) → Ft-13=1 obs
        → q28 opens (Ft-13=1) → Ft-16=1 obs
          → q44 opens (Ft-16=1, P3/P4 conceivable)
```

## 再検証結果

### anomaly_discovery（修正後）

```
Part 1: 初期オープン汚染チェック → OK
  初期オープン質問: 3件（q04, q10, q11）
  anomaly 汚染: 0件

Part 2: 発掘連鎖シミュレーション → OK (17/17)

  Step  1: q04 回答 → 14件発掘
    (q01, q02, q03, q05, q06, q07, q08, q09,
     q15, q16, q17, q18, q41, q42)

  Step  8: q06 回答 → 1件発掘 (q40)

  Step 12: q15 回答 → 1件発掘 (q20)
    + safe chain: q24 opens

  Step 22: q28 回答 → 1件発掘 (q44)
    (safe chain: q24→q25→q28→q44)
```

### opening_reach（修正後）

NG のまま（構造的限界、修正対象外）。動的検証で anomaly 発掘が保証されているため、ゲーム進行に影響なし。

## パラダイムシフトの確認

シミュレーション中のパラダイムシフト:

| Step | 回答質問 | シフト | tension |
|------|---------|--------|---------|
| 10 | q08 | P1 → P3 | 5 → 1 |
| 11 | q09 | P3 → P4 | 1 → 0 |

**備考**: P2 をスキップして P1 → P3 に直接シフト。これは anomaly 蓄積による tension が threshold(5) を超えた時点で、explained_o が最大のパラダイムが P3 であったため。P2 の threshold(2) も同時に超過しているが、P3 の方が alignment が高い。

## 修正サマリ

| 分類 | 件数 | 開放記述素 |
|------|------|-----------|
| anomaly（前提なし） | 14 | Fs-11=1 |
| anomaly（前提あり） | 2 | Fs-11=1（q20, q40） |
| safe チェーン | 3 | Fs-11=1, Ft-11=1, Ft-13=1（q24, q25, q28） |
| 自動解決 | 1 | q44（修正不要） |
| **合計** | **19 + 1** | |

修正は desert_man.json に反映済み。

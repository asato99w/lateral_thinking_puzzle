# 質問生成：Phase 2（構造設計）+ Phase 3（質問生成）

## Phase 2: 質問構造設計

### Step 2-1: アノマリー目標設定

#### P1 のアノマリー目標

P1 の D⁻ のうち T で真:
- Fs-08, Fs-15, Ft-05, Ft-06, Ft-07, Ft-08, Ft-09, Ft-11, Ft-12, B-01, B-03, D-01, M-01, M-03

P1→P2 シフトに必要なアノマリー: Fs-08（不自然）、Ft-11/Ft-12（人為的採取）、B-01/D-01（人為的痕跡）
目標: P1 で 3〜5 個のアノマリーを蓄積し、P2 へシフト

#### P2 のアノマリー目標

P2 の D⁻ のうち T で真:
- Ft-05, Ft-09, Ft-19, B-03, B-04, M-01

P2→P3 シフトに必要なアノマリー: Ft-05（遭難）、Ft-09（生命危機）、Ft-19（安堵=救出）
目標: P2 で 2〜3 個のアノマリーを蓄積し、P3 へシフト

### Step 2-2: 認知的到達経路の逆算

#### P1 → P2 の経路

アノマリー質問の目標: Fs-08=1（不自然）を O に入れる

逆算:
- Fs-08 に到達するには → Fs-07（理由がある）が O にあると、R(P1) 経由で Fs-08 に到達可能
- Fs-07 に到達するには → Fs-06（食用キノコなし）から因果逆推
- Fs-06 は Fs-05（全て毒キノコ）から含意 → 初期オープン付近

層構造:
- 層 0: Ps に近い質問（キノコの状況、識別能力）
- 層 1: 食用キノコの不在に着目する質問
- 層 2: 不在の理由（不自然さ、人為的採取）

#### P2 → P3 の経路

アノマリー質問の目標: Ft-05=1（遭難）を O に入れる

逆算:
- Ft-05 に到達するには → M-01（困難な状況）が O にあると発想しやすい
- M-01 に到達するには → Fs-13（不安があった）→ 不安の深さへの問い
- 不安の深さ → B-03（遭難による危機）

層構造:
- 層 0: 人の存在に関する質問（P2 で初期オープン）
- 層 1: Aさんの状況に関する質問（なぜ人の存在が重要か）
- 層 2: 遭難に関する質問

### Step 2-3: 層構造への配置

| 層 | P1 | P2 |
|----|----|----|
| 0 | キノコ識別、基本状況確認 | 人の存在、推論に関する基本質問 |
| 1 | 食用キノコの不在、異常性への着目 | Aさんの状況、不安の深さ |
| 2 | 不自然さ、人為的採取のアノマリー | 遭難、生命危機のアノマリー |

---

## Phase 3: 質問生成

### 質問一覧

| ID | text | correct | 役割 | 大区分 | prerequisites | paradigms |
|----|------|---------|------|--------|---------------|-----------|
| q01 | Aさんはキノコの種類を見分けることができますか？ | yes | 探索 | I | [] | [P1, S1] |
| q02 | Aさんはキノコ狩りに来ていましたか？ | yes | 探索 | I | [] | [P1, S1] |
| q03 | Aさんは山や森にいましたか？ | yes | 探索 | I | [] | [P1, P2] |
| q04 | 食用キノコを探していましたか？ | yes | 探索 | I | [] | [P1] |
| q05 | Aさんは毒キノコを食べてしまう心配をしていましたか？ | no | 探索 | I | [] | [P1, S1] |
| q06 | 毒キノコしかないことにAさんはがっかりしましたか？ | no | 蓄積 | I | [] | [P1] |
| q07 | Aさんは毒キノコを必要としていましたか？ | no | 分岐(S1) | I | [] | [P1, S1] |
| q08 | 毒キノコしかないことは自然な状態ですか？ | no | 蓄積/駆動 | I | [Fs-06] | [P1] |
| q09 | 以前はこの場所に食用キノコもありましたか？ | yes | 蓄積 | I→II | [Fs-08] | [P1, P2] |
| q10 | 食用キノコがないのは誰かが採ったからですか？ | yes | 駆動 | II | [Fs-08] | [P1, P2] |
| q11 | この場所に人が来たことがありますか？ | yes | 駆動 | II | [Ft-12] | [P2] |
| q12 | 人が近くにいることが分かりましたか？ | yes | 探索 | II | [Ft-13] | [P2] |
| q13 | 人里が近い場所ですか？ | yes | 探索 | II | [Ft-13] | [P2] |
| q14 | Aさんは安堵する前に強い不安を感じていましたか？ | yes | 蓄積 | II | [] | [P1, P2] |
| q15 | Aさんは困難な状況にいましたか？ | yes | 蓄積/駆動 | II→III | [Fs-13] | [P2] |
| q16 | Aさんの不安は、生命に関わるものでしたか？ | yes | 駆動 | III | [M-01] | [P2] |
| q17 | Aさんは遭難していましたか？ | yes | 駆動 | III | [M-01] | [P2] |
| q18 | Aさんは助けを必要としていましたか？ | yes | 蓄積 | III | [Ft-05] | [P2, P3] |
| q19 | 人が近くにいることは、Aさんにとって助かる見込みを意味しましたか？ | yes | 蓄積 | III | [Ft-05, Ft-13] | [P2, P3] |
| q20 | 安堵した理由は、救助される可能性が見えたからですか？ | yes | 蓄積 | III | [Ft-05, Ft-18] | [P3] |
| q21 | 毒キノコしかないことから、Aさんは何かを推論しましたか？ | yes | 蓄積 | I→II | [] | [P1, P2] |
| q22 | キノコの状態は安堵の直接的な原因ですか？ | no | 蓄積 | II | [Ft-13] | [P2] |
| q23 | Aさんの安堵はキノコの食用価値とは別の情報によるものですか？ | yes | 蓄積 | II | [] | [P1, P2] |
| q24 | 毒キノコしかない状態から、人が来たことを推論できますか？ | yes | 偶然の開き | I→II | [Fs-06] | [P1, P2] |
| q25 | Aさんは帰り道が分からなくなっていましたか？ | yes | 蓄積 | III | [Ft-05] | [P3] |
| q26 | 遭難していたからこそ、人の存在に安堵したのですか？ | yes | 蓄積 | III | [Ft-05, Ft-13] | [P3] |
| q27 | キノコ狩りの最中に遭難して、毒キノコしかないのを見て食用キノコが誰かに採られた＝人が近くにいると気づき、助かる見込みがあると安堵したのですか？ | yes | クリア | III | [Ft-05, Ft-11] | [P3] |

### 役割の集計

| 役割 | 数 | 質問 |
|------|---|------|
| 探索 | 7 | q01, q02, q03, q04, q05, q12, q13 |
| 蓄積 | 10 | q06, q09, q14, q18, q19, q20, q21, q23, q25, q26 |
| 駆動 | 5 | q08, q10, q11, q16, q17 |
| 分岐 | 1 | q07 |
| 偶然の開き | 1 | q24 |
| 蓄積/駆動 | 2 | q08, q15 |
| クリア | 1 | q27 |

### 大区分の配置

| 大区分 | 質問 | 備考 |
|--------|------|------|
| I | q01-q07, q08 | P1 内の探索と S1 分岐 |
| I→II | q09, q21, q24 | P1→P2 遷移の準備 |
| II | q10-q13, q14, q15, q22, q23 | P2 内の探索と蓄積 |
| II→III | q15 | P2→P3 遷移の準備 |
| III | q16-q20, q25, q26, q27 | P3 内の蓄積とクリア |

### フェーズ到達保証の検証

#### P1 → P2 シフト

アノマリー導入質問:
- q08 (correct=no): effect = Fs-08=0 → P1 は Fs-08=0 と予測するが T は Fs-08=1。質問の正答が no ということは Fs-08=0 が O に入る。しかし P1 の予測と一致するためアノマリーにならない。

**修正**: q08 を再設計。「毒キノコしかないのは不自然ですか？」→ correct=yes とすると effect = Fs-08=1。P1 は Fs-08=0 と予測。O に Fs-08=1 が入る → P1 にアノマリー。

| ID | text | correct | 修正理由 |
|----|------|---------|---------|
| q08 | 毒キノコしかないのは不自然な状態ですか？ | yes | P1 にアノマリーを導入するため |

再検証:
- q08 (correct=yes): Fs-08=1 が O に入る。P1.P_pred(Fs-08)=0 → アノマリー ✓
- q10 (correct=yes): Ft-11=1, Ft-12=1 が O に入る。P1.P_pred(Ft-11)=0, P1.P_pred(Ft-12)=0 → アノマリー ✓
- q24 (correct=yes): B-01=1 が O に入る。P1.P_pred(B-01)=0 → アノマリー ✓

P1 での十分なアノマリー蓄積 → P2 へのシフトが可能 ✓

#### P2 → P3 シフト

アノマリー導入質問:
- q15 (correct=yes): M-01=1 が O に入る。P2.P_pred(M-01)=0 → アノマリー ✓
- q16 (correct=yes): Ft-09=1 が O に入る。P2.P_pred(Ft-09)=0 → アノマリー ✓
- q17 (correct=yes): Ft-05=1 が O に入る。P2.P_pred(Ft-05)=0 → アノマリー ✓

P2 での十分なアノマリー蓄積 → P3 へのシフトが可能 ✓

### 同化接続性の検証

#### P1 → P2 シフト後

P2 の Consistent(O, P2) から R(P2) 経由で新質問の effect に到達:
- Fs-08 ∈ O, P2 では D⁺ → Consistent
- Fs-08 → Ft-12 (R(P2), w=0.9) → Ft-11 (R(P2), w=0.9) → Ft-13 (R(P2), w=0.9)
- q11 の effect Ft-13 に到達可能 ✓
- q12, q13 の effect も Ft-13 経由で到達可能 ✓

#### P2 → P3 シフト後

P3 の Consistent(O, P3) から R(P3) 経由:
- Ft-05 ∈ O → Ft-06, Ft-07, Ft-08, Ft-09 に到達
- Ft-13 ∈ O → Ft-15 → Ft-18 → Ft-19 に到達
- q18, q19, q20 の effect に到達可能 ✓

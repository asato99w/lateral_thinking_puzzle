# サンプル運用ルール

## ディレクトリ命名

```
samples/NNN_タイトル/
```

- NNN: 3 桁連番（001, 002, ...）
- タイトル: 問題の通称

## 反復ディレクトリ

```
samples/NNN_タイトル/
  01_YYYYMMDD_内容/
  02_YYYYMMDD_内容/    ← 改善・再適用のたびに連番で追加
  03_YYYYMMDD_内容/
```

- 反復のたびに新しい連番ディレクトリを作成する
- YYYYMMDD: 反復の作成開始日
- サブディレクトリ名は `NN_YYYYMMDD_内容` の形式（例: `02_20260226_統合アルゴリズム適用`）

## ファイル命名

各反復ディレクトリ内のファイルは連番＋内容で命名する。

| ファイル名 | 内容 |
|---|---|
| 01_入力.md | Ps・Pt の定義 |
| 02_記述素展開.md | 記述素空間の生成結果 |
| 03_パラダイム発見.md | メインパス・サブパスの発見結果 |
| 04_内部構造構成.md | 各パラダイムの P_pred, R(P) |
| 05_質問生成.md | 質問群の生成結果 |
| 06_形式化.md | POC JSON データに変換可能な形式の整理 |
| 07_検証.md | 検証結果と補充内容 |

- 前段のファイルに変更がない場合は省略してよい
- 上記以外のファイルを追加してもよい（例: `質問生成_Q1.md`, `質問分類_Q3.md`）

## 06_形式化.md の要件

サンプルはデータインポートの元になるものであり、06_形式化.md は JSON への機械的変換が可能な完全データを含む。曖昧さや省略があってはならない。

### 必須セクション

#### 1. 前提事実（ps_values）

全 Ps 記述素の ID と値の完全リスト。

#### 2. 記述素 ID 一覧（all_descriptor_ids）

記述素空間に含まれる全記述素の ID リスト。

#### 3. パラダイム一覧（paradigms）

各パラダイム（メインパス・サブパラダイム全て）について以下を完全に記載する:

| 項目 | 内容 |
|------|------|
| id | パラダイム ID |
| name | パラダイム名 |
| p_pred | D+・D- の完全リスト（論理的予測の全体） |
| relations | R(P) の完全リスト（横辺＋ゲート辺、[ソース, ターゲット, w]） |

「前パラダイムと大部分が重複」等の省略は不可。全パラダイムを完全に記載する。

#### 4. 質問一覧（questions）

全質問について以下を完全に記載する:

| 項目 | 内容 |
|------|------|
| id | 質問 ID |
| text | 質問テキスト |
| ans_yes | 「はい」の場合の効果 [[記述素ID, 値], ...] |
| ans_no | 「いいえ」の場合の効果 [[記述素ID, 値], ...] |
| ans_irrelevant | 「関係ない」の場合の効果 [記述素ID, ...] |
| correct_answer | 正答（"yes" / "no" / "irrelevant"） |
| is_clear | クリア質問か（true/false） |
| prerequisites | 前提記述素の ID リスト（なければ空リスト） |
| related_descriptors | 関連記述素の ID リスト |
| topic_category | トピックカテゴリ ID |
| paradigms | 所属パラダイムの ID リスト |

prerequisites は「類型 A が 6 問」のような集約ではなく、各質問に対する具体的な割り当てを記載する。

#### 5. トピックカテゴリ一覧（topic_categories）

カテゴリ ID と名称の対応表。

### 完全性の基準

06_形式化.md から JSON への変換は、内容の解釈や推測を一切必要としない機械的操作でなければならない。以下を満たすこと:

- 全パラダイムが省略なく記載されている
- 全質問が省略なく記載されている
- 各質問の prerequisites が個別に指定されている
- 前段のファイル（01〜05）を参照しなくても JSON が生成できる

## 07_検証.md の検証項目

Phase 4（検証と反復）に準拠した検証を実施する。

| Step | 検証名 | 内容 |
|------|--------|------|
| 4a | 完全性検証 | 各パラダイムのアノマリー記述素が質問群でカバーされているか（局所条件・大域条件） |
| 4b | 同化接続性・発掘連鎖 | 適用保留中（スキップ） |
| 4c | 多層構造検証 | Q(P) の層構造品質（層0アノマリー比率、ボトルネック、アノマリー層分散） |
| 4d | シフト方向検証 | 静的分析（遷移方向スコア・駆動率）＋動的検証（シミュレーション） |
| 4e | 到達パス検証 | ゲームシミュレーションによる行き詰まり検出（先頭順＋ランダムN回） |
| 4f | 構造的品質診断 | 前提閉包性（L3-6）＋層間連鎖性（L3-7）の定量評価 |
| 4g | 不足ルーティング | 不足の種類に応じた差し戻し先の決定 |

Step 4e（到達パス検証）が大域目標を直接テストする中核検証。Step 4f は原因特定用の補助診断。

## 運用上の注意

- 各ファイル内で使用したアルゴリズム名・規則名を明記する
- 06_形式化の内容を JSON に変換し `app/poc/data/` に配置する
- 07_検証は 06_形式化の後に実施し、JSON データ投入前に全検証を通過させる

# 調律ラウンド 0001 — 2026-02-28

## 検証結果（修正前）

| 検証 | 結果 |
|------|------|
| L2-0 | NG (P3 固有アノマリー Ft-11 未発掘) |
| L2-1 | OK |
| L2-4 | OK |
| L2-5 | OK (51/51 T到達) |

## 診断

**対象**: L2-0（発掘連鎖） — 唯一の NG

**根本原因**: P3→P4 シフトが q08 回答直後（P3 で 1 問のみ）に発動し、Ft-11 生産に必要な質問連鎖（q09→...→q19、6 問）が完了しない。

1. **excavation_chain と reachability_sim の差異**: excavation_chain（L2-0）は `update()` に `resolve_caps` を渡さない。そのため resolve 条件は完全にスキップされ、シフトは tension + neighborhood のみで判定される
2. **P3→P4 即時シフト**: q08 回答後 tension(P3)=1, tension(P4)=0。P4 ∈ P3.neighbors で条件1・2 を満たし、resolve 条件なしのためシフト発動
3. **Ft-11 の生産チェーン**: Ft-11 は q19（prereqs=[Ft-09]）で生産。q19 到達には q09→Ft-01→q10→Ft-02→q11→Ft-05→q16→Ft-07→q18→Ft-09→q19 の 6 問連鎖が必要。P3 で 1 問では到達不能
4. **reachability_sim（L2-5）が OK な理由**: L2-5 は `resolve_caps` を `update()` に渡しており、resolve_cap(P3→P4)=2 がゲートとして機能。P3 anomaly は {Fs-04, Ft-11} の 2 つで、両方が state.o に入るまでシフトが阻止される

**アルゴリズム不備の検討**: 修正は `shift_threshold` 設定で対処可能。

## 修正内容

修正分類: **パラダイム構造**（shift_threshold 設定）

### P4 修正

| フィールド | 変更 |
|---|---|
| shift_threshold | 新規追加: 2 |

**根拠**: P3 の anomaly は {Fs-04, Ft-11} の 2 つ。P4 は両方を正しく予測する（resolve_cap=2）。shift_threshold=2 を設定することで、excavation_chain シミュレーション（resolve_caps なし）でも effective_n=2 となり、Ft-11 が state.o に入るまで P3→P4 シフトが阻止される。reachability_sim（resolve_caps あり）では min(2, 2)=2 で一貫。

## 検証結果（修正後）

| 検証 | 結果 | 変化 |
|------|------|------|
| L2-0 | OK (P3: 12問回答, Ft-11 発掘, step 18 でシフト) | 改善 |
| L2-1 | OK | 維持 |
| L2-4 | OK | 維持 |
| L2-5 | OK (51/51 T到達) | 維持 |

# 質問生成：Phase 2（構造設計）+ Phase 3（質問生成）

入力:
- 記述素空間（02_記述素展開.md: F' = F ∪ B ∪ M）
- パラダイム群（03_パラダイム発見.md）
- 内部構造（04_内部構造分析.md）

## Phase 2: 質問構造設計

### Step 2-1: アノマリー目標設定

#### P1 のアノマリー目標

P1 の D- のうち T で真（主要なもの）:
- Fs-05(到達困難), Fs-10(事故死), Fs-19(火以外), Fs-20(異常), Fs-21(マッチと死の関係)
- Ft-01〜Ft-25 の大部分, D-01〜D-03, B-01〜B-05, M-01, M-03, M-04, M-05

P1→P2 シフトに必要なアノマリー: Fs-05(到達困難=真), D-03(地上移動でない=真), M-01(死因は砂漠でない=真), Ft-24(落下死=真)
目標: P1 で 3〜4 個のアノマリーを蓄積し P2 へシフト

#### P2 のアノマリー目標

P2 の D- のうち T で真（主要なもの）:
- Ft-03(複数人), Ft-07(生命の危機), Ft-08〜Ft-22, Ft-25
- D-01, D-02, B-02〜B-05, M-02〜M-05

P2→P3 シフトに必要なアノマリー: Ft-03(複数人=真), Ft-07(生命の危機=真), Ft-08(軽量化=真), Ft-11(服を脱いだ=真), M-04(他者と一緒=真)
目標: P2 で 3〜4 個のアノマリーを蓄積し P3 へシフト

#### P3 のアノマリー目標

P3 の D- のうち T で真:
- Ft-04(熱気球), Ft-16(人の重量), Ft-17(犠牲の決断), Ft-18(くじ引き), Ft-19(集団的決断), Ft-20(マッチでくじ), Ft-21(マッチの長短), Ft-22(くじに負けた), Ft-25(自ら飛び降り)
- D-02, B-03, B-05, M-03

P3→P4 シフトに必要なアノマリー: Ft-16(人の重量), Ft-17(犠牲の決断), Ft-20(マッチでくじ)
目標: P3 で 2〜3 個のアノマリーを蓄積し P4 へシフト

### Step 2-2: 認知的到達経路の逆算

#### P1 → P2 の経路

逆算:
- M-01=1 に到達するには → Fs-08=0 が O にあると、「脱水死ではない→別の死因」の推論が可能
- Fs-08=0 に到達するには → q01（死因は脱水か？→no）が必要
- D-03=1 に到達するには → Fs-05=1 が O にあると、「到達困難→地上ではない」の推論が可能
- Fs-05=1 に到達するには → q07（徒歩で来たか？→no）→ Fs-22=0 → 到達手段の再考

#### P2 → P3 の経路

逆算:
- Ft-11=1 に到達するには → Ft-08=1（軽量化）が O にある必要
- Ft-08=1 に到達するには → Ft-07=1（生命の危機）→ Ft-06=1（墜落の危険）→ Ft-05=1（トラブル）
- M-04=1 に到達するには → Ft-03=1（複数人）が O にある必要
- Ft-03=1 に到達するには → q02（一人か？→no）→ M-04=1

#### P3 → P4 の経路

逆算:
- Ft-20=1 に到達するには → Ft-17=1（犠牲の決断）が O にある必要
- Ft-17=1 に到達するには → Ft-16=1（人の重量減少）→ Ft-14=1（軽量化不十分）
- Ft-14=1 に到達するには → q17（全ての軽量化が不十分か？→yes）

### Step 2-3: 層構造への配置

| 層 | P1→P2 遷移 | P2→P3 遷移 | P3→P4 遷移 |
|----|-----------|-----------|-----------|
| 0 | 死因確認、基本状況 | 乗り物の詳細 | 軽量化の限界 |
| 1 | 移動手段の否定、死因の否定 | トラブル、複数人 | 犠牲の必要性 |
| 2 | 上空仮説の導入 | 軽量化の発見 | くじ引きの発見 |

---

## Phase 3: 質問生成

### 質問一覧

| ID | text | correct | 役割 | 大区分 | prerequisites | paradigms |
|----|------|---------|------|--------|---------------|-----------|
| q01 | 男の死因は砂漠の環境（暑さや脱水）によるものですか？ | no | 蓄積/駆動 | I | [] | [P1] |
| q02 | 男は一人でしたか？ | no | 蓄積/駆動 | I | [] | [P1, S1] |
| q03 | マッチ棒は火をつけるためのものですか？ | no | 蓄積 | I | [] | [P1, S2] |
| q04 | 男は自分で服を脱ぎましたか？ | yes | 探索 | I | [] | [P1, P3] |
| q05 | 男は犯罪の被害者ですか？ | no | 分岐(S1排除) | I | [] | [P1, S1] |
| q06 | 死の直前に緊迫した状況がありましたか？ | yes | 探索 | I | [] | [P1, P2, P3] |
| q07 | 男は砂漠を歩いて来ましたか？ | no | 駆動 | I→II | [] | [P1] |
| q08 | 男の死因は落下によるものですか？ | yes | 駆動 | I→II | [Fs-08] | [P1, P2] |
| q09 | 男は上空にいましたか？ | yes | 駆動 | II | [D-03] | [P1, P2] |
| q10 | 男は乗り物に乗っていましたか？ | yes | 探索 | II | [Ft-01] | [P2] |
| q11 | 乗り物にトラブルが発生しましたか？ | yes | 探索 | II | [Ft-02] | [P2] |
| q12 | 墜落の危険がありましたか？ | yes | 蓄積 | II→III | [Ft-05] | [P2, P3] |
| q13 | 複数人が乗っていましたか？ | yes | 蓄積/駆動 | II | [Ft-02] | [P2, P3] |
| q14 | 荷物を捨てましたか？ | yes | 蓄積 | III | [Ft-05] | [P2, P3] |
| q15 | 裸になったのは軽量化のためですか？ | yes | 駆動 | III | [Ft-08] | [P3] |
| q16 | 重量が問題でしたか？ | yes | 蓄積 | III | [Ft-05] | [P2, P3] |
| q17 | 軽量化は十分でしたか？ | no | 蓄積/駆動 | III | [Ft-09] | [P3] |
| q18 | 人の重量を減らす必要がありましたか？ | yes | 駆動 | III | [Ft-14] | [P3, P4] |
| q19 | 一人が犠牲になる決断がありましたか？ | yes | 駆動 | III→IV | [Ft-16] | [P3, P4] |
| q20 | マッチ棒はくじ引きの道具として使われましたか？ | yes | 駆動 | IV | [Ft-17] | [P4] |
| q21 | マッチの長さで当たり外れを決めましたか？ | yes | 蓄積 | IV | [Ft-20] | [P4] |
| q22 | 男はくじに負けましたか？ | yes | 蓄積 | IV | [Ft-20] | [P4] |
| q23 | 男は自ら飛び降りましたか？ | yes | 蓄積 | IV | [Ft-17] | [P4] |
| q24 | 乗り物は熱気球ですか？ | yes | 探索 | II | [Ft-02] | [P2, P3, P4] |
| q25 | 熱気球が高度を失い、荷物や服を捨てても足りず、マッチの長さのくじ引きで負けた男が飛び降りて死亡したのですか？ | yes | クリア | IV | [Ft-14, Ft-20] | [P4] |

### 質問の詳細定義

#### 単一記述素・肯定形

| ID | ans_yes | ans_no | ans_irrelevant | correct |
|----|---------|--------|----------------|---------|
| q04 | [(Fs-13, 1), (M-02, 1)] | [(Fs-13, 0)] | [Fs-13] | yes |
| q06 | [(M-05, 1)] | [(M-05, 0)] | [M-05] | yes |
| q08 | [(Ft-24, 1)] | [(Ft-24, 0)] | [Ft-24] | yes |
| q09 | [(Ft-01, 1)] | [(Ft-01, 0)] | [Ft-01] | yes |
| q10 | [(Ft-02, 1)] | [(Ft-02, 0)] | [Ft-02] | yes |
| q11 | [(Ft-05, 1)] | [(Ft-05, 0)] | [Ft-05] | yes |
| q12 | [(Ft-06, 1)] | [(Ft-06, 0)] | [Ft-06] | yes |
| q13 | [(Ft-03, 1), (M-04, 1)] | [(Ft-03, 0)] | [Ft-03] | yes |
| q14 | [(Ft-09, 1), (Ft-08, 1)] | [(Ft-09, 0)] | [Ft-09] | yes |
| q15 | [(Ft-11, 1), (B-02, 1)] | [(Ft-11, 0)] | [Ft-11] | yes |
| q16 | [(Ft-10, 1)] | [(Ft-10, 0)] | [Ft-10] | yes |
| q18 | [(Ft-16, 1)] | [(Ft-16, 0)] | [Ft-16] | yes |
| q19 | [(Ft-17, 1), (Ft-19, 1)] | [(Ft-17, 0)] | [Ft-17] | yes |
| q21 | [(Ft-21, 1)] | [(Ft-21, 0)] | [Ft-21] | yes |
| q22 | [(Ft-22, 1), (B-05, 1)] | [(Ft-22, 0)] | [Ft-22] | yes |
| q23 | [(Ft-25, 1)] | [(Ft-25, 0)] | [Ft-25] | yes |
| q24 | [(Ft-04, 1)] | [(Ft-04, 0)] | [Ft-04] | yes |

#### 否定形・逆極性の質問

| ID | ans_yes | ans_no | ans_irrelevant | correct | 備考 |
|----|---------|--------|----------------|---------|------|
| q01 | [(Fs-08, 1)] | [(Fs-08, 0), (M-01, 1)] | [Fs-08] | no | 脱水否定→M-01=1 が導入される |
| q02 | [(M-04, 0)] | [(M-04, 1), (Ft-03, 1)] | [M-04] | no | 一人否定→M-04=1, Ft-03=1 |
| q03 | [(Fs-18, 1)] | [(Fs-18, 0), (M-03, 1)] | [Fs-18] | no | 火の目的否定→M-03=1 |
| q05 | [(Fs-23, 1), (Fs-09, 1)] | [(Fs-23, 0), (Fs-09, 0)] | [Fs-23] | no | S1 排除 |
| q07 | [(Fs-22, 1)] | [(Fs-22, 0), (D-03, 1)] | [Fs-22] | no | 徒歩否定→D-03=1（地上移動でない） |
| q17 | [(Ft-14, 0)] | [(Ft-14, 1), (Ft-15, 1)] | [Ft-14] | no | 十分否定→Ft-14=1, Ft-15=1 |

#### 複合記述素の質問

| ID | ans_yes | ans_no | ans_irrelevant | correct | 設計意図 |
|----|---------|--------|----------------|---------|---------|
| q20 | [(Ft-20, 1), (D-02, 1)] | [(Ft-20, 0)] | [Ft-20] | yes | P4 駆動: マッチの用途転換 |

#### クリア質問

| ID | ans_yes | ans_no | ans_irrelevant | correct | is_clear |
|----|---------|--------|----------------|---------|---------|
| q25 | [(Ft-04, 1), (Ft-14, 1), (Ft-20, 1), (Ft-22, 1)] | [(Ft-22, 0)] | [Ft-22] | yes | true |

### 役割の集計

| 役割 | 数 | 質問 |
|------|---|------|
| 探索 | 5 | q04, q06, q10, q11, q24 |
| 蓄積 | 5 | q12, q14, q16, q21, q22 |
| 駆動 | 5 | q07, q08, q09, q15, q20 |
| 蓄積/駆動 | 4 | q01, q02, q13, q17 |
| 分岐 | 1 | q05 |
| 蓄積→駆動 | 2 | q18, q19 |
| クリア | 1 | q25 |
| 蓄積(P4) | 1 | q23 |

### 大区分の配置

| 大区分 | 質問 | 備考 |
|--------|------|------|
| I | q01, q02, q03, q04, q05, q06 | P1 内の探索・蓄積と S1/S2 分岐 |
| I→II | q07, q08 | P1→P2 遷移の準備 |
| II | q09, q10, q11, q13, q24 | P2 内の探索と蓄積 |
| II→III | q12 | P2→P3 遷移の準備 |
| III | q14, q15, q16, q17, q18 | P3 内の探索と蓄積 |
| III→IV | q19 | P3→P4 遷移の準備 |
| IV | q20, q21, q22, q23, q25 | P4 内の蓄積とクリア |

### フェーズ到達保証の検証

#### P1 → P2 シフト

アノマリー導入質問:
- q01 (correct=no): Fs-08=0, M-01=1 が O に入る。P1.P_pred(Fs-08)=1 → Fs-08=0 は P1 にアノマリー。P1.P_pred(M-01)=0 → M-01=1 も P1 にアノマリー ✓
- q07 (correct=no): Fs-22=0, D-03=1 が O に入る。P1.P_pred(Fs-22)=1 → アノマリー。P1.P_pred(D-03)=0 → D-03=1 もアノマリー ✓
- q02 (correct=no): M-04=1, Ft-03=1 が O に入る。P1.P_pred(M-04)=0, P1.P_pred(Ft-03)=0 → アノマリー ✓

P1 での十分なアノマリー蓄積 → P2 へのシフトが可能 ✓

#### P2 → P3 シフト

アノマリー導入質問:
- q13 (correct=yes): Ft-03=1, M-04=1 が O に入る。P2.P_pred(Ft-03)=0 → アノマリー ✓
- q06 (correct=yes): M-05=1 が O に入る。P2.P_pred(M-05)=0 → アノマリー ✓
- q04 (correct=yes): Fs-13=1, M-02=1 が O に入る。P2.P_pred(Fs-13)=0, P2.P_pred(M-02)=0 → アノマリー ✓

P2 での十分なアノマリー蓄積 → P3 へのシフトが可能 ✓

#### P3 → P4 シフト

アノマリー導入質問:
- q18 (correct=yes): Ft-16=1 が O に入る。P3.P_pred(Ft-16)=0 → アノマリー ✓
- q19 (correct=yes): Ft-17=1, Ft-19=1 が O に入る。P3.P_pred(Ft-17)=0, P3.P_pred(Ft-19)=0 → アノマリー ✓
- q20 (correct=yes): Ft-20=1, D-02=1 が O に入る。P3.P_pred(Ft-20)=0, P3.P_pred(D-02)=0 → アノマリー ✓

P3 での十分なアノマリー蓄積 → P4 へのシフトが可能 ✓

### 同化接続性の検証

#### P1 → P2 シフト後

Consistent(O, P2) から R(P2) 経由で新質問の effect に到達:
- D-03 ∈ O, P2.P_pred(D-03)=1 → Consistent
- D-03 → Ft-01 (R(P2), w=0.9) → Ft-02 (R(P2), w=0.9)
- q09 の effect Ft-01 に到達可能 ✓
- q10 の effect Ft-02 に到達可能 ✓
- Ft-02 → Ft-05 → Ft-23 → Ft-24 に到達可能 ✓

#### P2 → P3 シフト後

Consistent(O, P3) から R(P3) 経由:
- Ft-05 ∈ O → Ft-06 → Ft-07 → Ft-08 → Ft-09, Ft-11 に到達
- q14 (Ft-09), q15 (Ft-11) の effect に到達可能 ✓

#### P3 → P4 シフト後

Consistent(O, P4) から R(P4) 経由:
- Ft-14 ∈ O → Ft-15 → Ft-16 → Ft-17 → Ft-18 → Ft-20 → Ft-21, Ft-22 に到達
- q20, q21, q22 の effect に到達可能 ✓

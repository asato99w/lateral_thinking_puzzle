---
name: theory-update
description: theory/ 内のアルゴリズム・ルール・構造文書を更新する。影響範囲の特定と下流への波及報告を含む。
argument-hint: [変更内容の説明]
disable-model-invocation: true
allowed-tools: Read, Write, Edit, Bash, Glob, Grep
---

# /theory-update — アルゴリズム更新

引数: `$ARGUMENTS`（変更内容の説明）
- 例: `/theory-update Phase 1 に包含連鎖チェックのステップを追加`
- 変更内容が不明確な場合はユーザーに確認する

## 事前条件

- 変更の動機が明確であること（検証結果、分析ノート、ユーザーの指示等）
- theory/ は依存方向の最上流であり、変更は下流（サンプル → アプリデータ）に波及する。この認識のもとで作業すること

## theory/ の構造

### 4階層

| 階層 | 位置 | 役割 |
|------|------|------|
| 統合アルゴリズム | `integration/algorithms/` | Phase 間の流れと接続 |
| 統合ルール | `integration/rules/` | Phase 横断の規則 |
| 個別アルゴリズム | `{paradigm,question,expansion,supplementary}/algorithms/` | 各 Phase 内の具体的手順 |
| 個別ルール | `{paradigm,question,expansion,supplementary}/rules/` | 手順内の詳細な構成規則 |

### その他

| 位置 | 役割 |
|------|------|
| `structure/` | パラダイム・記述素空間等の構造定義 |
| `terms.md` | 用語定義 |
| `integration/evaluation/` | メトリクス定義 |
| `updates/` | 更新手続き（ゲーム内のH更新） |

## 手順

### 1. 変更対象の特定

変更内容を分析し、4階層のどのファイルに影響するかを特定する。

- 統合アルゴリズムの変更は稀で影響が最大。統合ルール以下の変更は局所的になりやすい
- 変更対象ファイルを列挙し、ユーザーに確認する

### 2. 影響範囲の分析

変更対象から以下の方向に波及を確認する:

**縦方向（階層間）**:
- 上位 → 下位: 統合アルゴリズムの変更は統合ルール・個別アルゴリズム・個別ルールに波及しうる
- 下位 → 上位: 個別ルールの変更が上位の手順記述と矛盾しないか

**横方向（同階層内）**:
- 同じ階層の他のファイルとの整合性（例: 個別ルール間で前提が矛盾しないか）

**定義文書**:
- `structure/` の定義と矛盾しないか
- `terms.md` の用語定義に影響するか

**下流**:
- 既存サンプル（`samples/`）が変更後のアルゴリズムと乖離するか
- 検証スクリプト（`app/poc/scripts/eval/`）に影響するか

影響範囲をユーザーに報告する。

### 3. 変更の実行

特定したファイルを修正する。

- 変更箇所には他の手順やルールとの参照関係を維持する
- 新しいステップやルールを追加する場合は、既存の番号体系・文書スタイルに従う

### 4. 整合性の確認

変更後に以下を確認する:

- 変更したファイル内で上位・下位への参照が正しいか
- 影響範囲として特定したファイルとの整合性が保たれているか
- 用語の使い方が `terms.md` と一致しているか

### 5. 下流への影響報告

以下をユーザーに報告する:

- **サンプルへの影響**: 既存サンプルのうち、変更されたルール・アルゴリズムを参照しているものを列挙する。再生成が必要な場合はその旨を明示する
- **検証スクリプトへの影響**: メトリクス定義の変更がスクリプトに波及する場合はその旨を報告する
- 影響がない場合は「下流への影響なし」と報告する

## 参照ファイル

- `theory/terms.md` — 用語定義
- `theory/structure/` — 構造定義
- `samples/_template.md` — サンプルの命名規則（影響報告時に参照）

## 禁止事項

- **サンプルからの逆流禁止**: サンプルの内容に合わせてアルゴリズムを修正してはならない。依存方向は常にアルゴリズム → サンプル。サンプルの問題はサンプル側で対処する
- **暗黙の変更禁止**: 影響範囲の分析で特定されなかったファイルを暗黙に変更しない。追加の変更が必要と判明した場合はユーザーに報告する

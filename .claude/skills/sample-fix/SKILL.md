# /sample-fix — サンプル修正

## 概要

既存サンプルを指定されたアルゴリズムと突き合わせ、乖離を特定し、影響範囲を再生成する。修復完了後、まだ先の生成が必要であれば `/sample-generate` に引き渡す。

## 引数

- `$ARGUMENTS`: 対象サンプルのパスとアルゴリズムのパス
  - 例: `samples/001_ウミガメのスープ/09_20260219_統合アルゴリズム適用 theory/integration/algorithms/統合アルゴリズム.md`
- アルゴリズムが指定されていない場合、ユーザーに確認する
- 問題箇所が明示されている場合はそれも受け付ける

## 手順

### 1. 乖離の特定

以下の情報源から、サンプルと現在の理論との乖離を特定する:

- **git履歴**: サンプルの最終更新コミット以降の `theory/` への変更を `git log` で取得し、どの規則・アルゴリズムが変更されたかを把握する
- **ファイル冒頭の規則名**: サンプル各ファイルが参照している規則と、現在の理論の内容を突き合わせる
- **ユーザーの指摘**: 問題箇所が明示されている場合はそれも加味する

特定できた乖離をユーザーに報告する。判断がつかない部分がある場合はその旨を明示してユーザーに確認する。

### 2. 依存関係の解析

アルゴリズムの依存構造を読み、乖離のあるファイルに依存しているファイルを特定する。

### 3. 影響ファイルの削除

乖離のあるファイルと、それに依存するファイルを削除する。上流の正常なファイルは保持する。

削除対象をユーザーに提示し、確認を得てから実行する。

### 4. 穴埋め再生成

削除したファイルを、上流の生成済みファイルを入力としてアルゴリズムに従い再生成する。

### 5. 後続生成の判定

穴埋めが完了した時点で、アルゴリズムの残りの手順がある場合は `/sample-generate` での続行をユーザーに提案する。

## 参照ファイル

- 指定されたアルゴリズム — 依存構造と手順の定義元
- `samples/_template.md` — 命名規則

## 禁止事項

**既存サンプル・既存データの参照禁止**: 再生成時に、他のサンプルや `app/poc/data/` 内の JSON データを参考にしてはならない。入力は理論（`theory/`）と対象反復ディレクトリ内の上流ファイルのみ。

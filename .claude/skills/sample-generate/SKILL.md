---
name: sample-generate
description: 指定されたアルゴリズムに従いサンプル文書を生成する。新規生成・中断からの再開・理論変更に伴う再生成に使う。
argument-hint: [パズルタイトル] [アルゴリズムパス]
disable-model-invocation: true
allowed-tools: Read, Write, Glob, Grep, Bash, Edit
---

# /sample-generate — サンプル生成

引数: `$ARGUMENTS`（パズルのタイトルとアルゴリズムのパス）
- 例: `/sample-generate ウミガメのスープ theory/integration/algorithms/統合アルゴリズム.md`
- `$0` = パズルタイトル、`$1` = アルゴリズムパス
- アルゴリズムが指定されていない場合、ユーザーに確認する

## 事前条件

- 問題文（S）と真理論（T）が提示されていること
- 対象パズルの NNN 連番が決まっていること（既存の場合は次の反復連番を付与）

## 手順

### 1. 状態の判定

対象の反復ディレクトリを確認する。

- **ディレクトリが存在しない**: 新規生成。ディレクトリを作成して手順2へ
- **ディレクトリが存在し、ファイルがある**: 再開。生成済みファイルからアルゴリズムのどの段階まで完了しているかを判断し、続きから手順2へ

ディレクトリ命名: `samples/NNN_タイトル/NN_YYYYMMDD_アルゴリズム名適用/`

### 2. アルゴリズム適用

`/theory-execute` を使用して、指定されたアルゴリズムを Phase ごとに遂行する。各 Phase の出力をファイルとして順次生成する。

- `/theory-execute` が各 Phase の参照ファイル展開と完了チェックを担う
- 各ファイルの冒頭に使用した規則・アルゴリズム名を明記する
- 生成済みファイルは変更しない。差し戻しが発生した場合は新しいファイルを追加する
- ファイルの数や名前はアルゴリズムの進行と反復に応じて決まる

### 3. 形式化

アルゴリズム適用の最終段階として、`/sample-import` で取り込み可能な形式化ファイルを生成する。

形式化ファイルは `app/poc/src/models.py` のデータ構造が要求する全フィールドを満たす完全データを含む。省略・曖昧さがあってはならない。

形式化ファイルから JSON への変換は、内容の解釈や推測を一切必要としない機械的操作でなければならない。

### 4. 反復判定

検証で NG が出た場合はユーザーに報告し、反復の要否を確認する。

## 参照ファイル

- 指定されたアルゴリズム — 手順の定義元
- `app/poc/src/models.py` — 形式化の仕様定義元
- `samples/_template.md` — 命名規則

## アルゴリズムとの整合関係

### 実行者の裁量範囲

アルゴリズムと実行者の関係は、戦略 > 作戦 > 戦術の三階層で整理される。

- **戦略 + 作戦** = アルゴリズムが規定する範囲。大方針から具体的手順まで含む
- **戦術** = 実行者に残される裁量。最下位レベルであり限定的

実行者の裁量は戦術レベルに限られる。表現の選び方、記述の順序、具体例の選択などがこれにあたる。パラダイムの構造設計、R(P) の辺構成、質問設計などの手順はアルゴリズムが規定しており、実行者の裁量で独自の方法を取ってはならない。

### アルゴリズムの4階層を参照する

アルゴリズムは以下の4階層で構成されている。各 Phase で必ず対応する全階層を参照すること。

1. **統合アルゴリズム** — Phase 間の流れと接続
2. **統合ルール** — Phase 横断の規則（空間構築、質問構造設計等）
3. **個別アルゴリズム** — 各 Phase 内の具体的手順
4. **個別ルール** — 手順内の詳細な構成規則

上位の階層だけを見て下位の手順を見落とすと、本来アルゴリズムが規定している手順を自己判断で代替することになる。

### アルゴリズムに手順がない場合

アルゴリズムに手順が規定されていないと判断した場合:

1. まず4階層すべてを確認する（上位だけで判断しない）
2. それでも手順がない場合は、アルゴリズムの原則に立ち返り、その操作が原則と整合するか検討する
3. 判断に迷う場合はユーザーに確認する。独自に作戦レベルの判断を行ってはならない

## 禁止事項

**既存サンプル・既存データの参照禁止**: サンプル生成時に、既存の `samples/` 内の他のサンプルや `app/poc/data/` 内の JSON データを参考にしてはならない。入力は理論（`theory/`）と問題文（S, T）のみ。既存サンプルを参照すると、過去の誤りや構造的欠陥が伝播する。形式化ステップ（手順3）では内容の生成は完了しているため、フォーマット確認目的での既存データ参照による内容汚染リスクは低いが、既存データが正しい保証はない点に注意すること。

## 注意事項

- 各ファイルで参照した規則名を冒頭に明記する

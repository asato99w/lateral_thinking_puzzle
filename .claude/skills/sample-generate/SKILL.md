# /sample-generate — サンプル生成（正式フロー）

## 概要

統合アルゴリズムに従い、入力からサンプル文書を生成する。
サンプルの再生成が必要な場合の正式フローはこのスキルを使う。

## 引数

- `$ARGUMENTS`: パズルのタイトル（例: `ウミガメのスープ`）

## 事前条件

- 問題文（S）と真理論（T）が提示されていること
- 対象パズルの NNN 連番が決まっていること（既存の場合は次の反復連番を付与）

## 手順

### 1. ディレクトリ作成

```
samples/NNN_タイトル/NN_YYYYMMDD_統合アルゴリズム適用/
```

- NNN: パズル連番（既存なら既存の NNN を使用、新規なら次の連番）
- NN: 反復連番（既存パズルなら最後の反復 +1、新規なら 01）
- YYYYMMDD: 本日の日付

### 2. アルゴリズム適用

統合アルゴリズム（`theory/integration/algorithms/統合アルゴリズム.md`）に従い、各フェーズの出力をファイルとして順次生成する。各ファイルの冒頭に使用した規則・アルゴリズム名を明記する。

生成済みファイルは変更しない。差し戻しが発生した場合は新しいファイルを追加する。

ファイルの数や名前はアルゴリズムの進行と反復に応じて決まる。以下は典型的な流れであり、固定ではない:

- Phase 1（空間構築）: 入力定義、記述素展開、パラダイム発見、内部構造構成
- Phase 2（質問構造設計）: アノマリー目標設定、認知的到達経路の逆算、層構造への配置
- Phase 3（質問生成）: 質問候補生成、認知的前提の設定、役割付与・大区分配置
- Phase 4（検証と反復）: 下記の検証項目を実施

### 3. 形式化

アルゴリズム適用の最終段階として、`/sample-import` で取り込み可能な形式化ファイルを生成する。

形式化ファイルは `app/poc/src/models.py` のデータ構造（`Paradigm`, `Question` 等）が要求する全フィールドを満たす完全データを含む。省略・曖昧さがあってはならない。

形式化ファイルから JSON への変換は、内容の解釈や推測を一切必要としない機械的操作でなければならない。

### 4. 検証（Phase 4）

Phase 4 の各 Step を順に実施する:

| Step | 検証名 | 内容 |
|------|--------|------|
| 4a | 完全性検証 | 各パラダイムのアノマリー記述素が質問群でカバーされているか |
| 4b | 同化接続性・発掘連鎖 | スキップ（適用保留中） |
| 4c | 多層構造検証 | Q(P) の層構造品質 |
| 4d | シフト方向検証 | 遷移方向スコア・駆動率＋シミュレーション |
| 4e | 到達パス検証 | ゲームシミュレーションによる行き詰まり検出 |
| 4f | 構造的品質診断 | 前提閉包性（L3-6）＋層間連鎖性（L3-7） |
| 4g | 不足ルーティング | 不足があれば差し戻し先を特定し報告 |

### 5. 反復判定

Step 4e（到達パス検証）が NG の場合:
1. Step 4f の診断結果から原因候補を特定
2. Step 4g で差し戻し先を決定
3. ユーザーに報告し、反復の要否を確認

差し戻し時は該当 Phase のファイルを新規追加する（既存ファイルは変更しない）。

## 参照ファイル

- `theory/integration/algorithms/統合アルゴリズム.md` — 全体手順
- `theory/integration/rules/` — 各統合ルール
- `app/poc/src/models.py` — 形式化の仕様定義元
- `samples/_template.md` — 命名規則

## 注意事項

- Phase 2（質問構造設計）はアノマリーからの逆算が核心。安易なボトムアップ生成をしない
- 各ファイルで参照した規則名を冒頭に明記する

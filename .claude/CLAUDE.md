# プロジェクトルール

## 用語

- **アルゴリズム**: `theory/` 内の理論的手順群。サンプルを生成するためのアルゴリズムを指す。エンジンのコードではない
- **サンプル**: `samples/` 内の非構造化テキスト。アルゴリズムをパズルに適用する過程で順次生成される。これを元にアプリデータ（JSON）が作成される
- **ノート**: `notes/` 内の分析・検討メモ。`YYYY-MM-DD_テーマ.md` の命名規則
- 依存方向: **アルゴリズム → サンプル → アプリデータ**

## オープンクローズド原則（Phase A に適用）

アルゴリズムをパズルに適用してサンプルを生成する過程に適用される原則。

- 生成済みのサンプルファイルは変更しない
- 修正が必要な場合は、影響範囲のファイルを削除して再生成する
- 理論が変更された場合も同様。古いサンプルにパッチを当てるのではなく、削除して現行の理論から再生成する

## サンプル生成の入力制約

- サンプル生成の入力は **理論（`theory/`）と問題文（S, T）のみ**
- 既存の `samples/` 内の他のサンプルや `app/poc/data/` 内の JSON データを参考にしてはならない
- 既存サンプルを参照すると過去の誤りが伝播するため、これは厳格なルールである

## 理論とエンジンの関係

- 理論がうまくいかなかった時（シミュレーション結果が期待と異なる等）、エンジンやデータを勝手に修正しない
- まず「何がどううまくいかなかったか」を報告し、ユーザーの指示を待つ
- 指示に応じて、ノートにまとめるか分析を行う
- 依存方向: 理論 → エンジン → データ。シミュレーションが失敗した場合、原因はデータ側（評価スクリプトの不足・データの不適合）にある可能性を最初に疑う

## Phase A / Phase B の区分

### Phase A: サンプル生成（理論駆動）
- 依存方向: アルゴリズム → サンプル → アプリデータ（初回 JSON）
- スキル: `/sample-generate` → `/sample-import`
- オープンクローズド原則・入力制約が適用される

### Phase B: データ調律（検証駆動）
- 依存方向: 検証スクリプト ↔ JSON データ
- スキル: `/data-tune`
- JSON を eval 結果に基づき直接編集する
- 変更履歴は `samples/{puzzle}/{iteration}/history/` に記録（追記専用）
- 理論・エンジン・eval スクリプトは変更しない

# 次の質問の決定

## 概要

回答後に状態を更新し、新たにオープンされる質問を決定する。

## 入力

- 現在の H
- 現在のパラダイム P_current
- 回答済みの質問 q
- effect(q)

## 処理

### Step 1: 直接更新

effect(q) の各 (d, v) について:
- H(d) ← v
- d を O に追加

### Step 2: 同化

effect(q) の各 (d, v) について、d ∈ D(P_current) かつ P_current(d) = v の場合:

R(P_current) の辺 (d, d', w) について:

**H(d') ← H(d') + w × (P_current(d') − H(d'))**

P_current と整合する情報のみ伝播する。矛盾する情報は同化されず、Step 3 で蓄積として検出される。

### Step 3: パラダイムシフト判定

**consistency(O, P) = |{d ∈ D(P) ∩ O | P(d) = O(d)}| / |D(P) ∩ O|**

- consistency(O, P_current) < threshold → パラダイムシフト
- シフト先: P_new = argmax_{P'} consistency(O, P')
- P_new = P_current または全 P' が threshold 未満 → 危機状態（P_current を維持して継続）

シフト後の H 再構成:

```
for each d ∈ O ∩ D(P_new) where P_new(d) = O(d):
    for each (d, d', w) ∈ R(P_new):
        H(d') ← H(d') + w × (P_new(d') - H(d'))
```

既存の観測を P_new の関係構造で再解釈する。同化と同一のロジック。

### Step 4: オープン再計算

**open(H) = { q | ∃(d, v) ∈ effect(q) : H(d) ≈ v }**

回答済みの質問を除外し、新たにオープンされた質問を特定する。

## 出力

- 更新後の H
- 更新後の P_current
- 新たにオープンされた質問群（0〜複数）

## 設計上の注意

- 粘性は同化（Step 2）と open(H)（Step 4）が担う
- シフト判定（Step 3）は O vs P で客観的に行い、H に依存しない
- threshold は POC で調整する設計パラメータ
